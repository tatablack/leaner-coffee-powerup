{"version":3,"file":"settings.bffe066899ea16e8eaea.js","mappings":"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","sources":["webpack://leancoffee-powerup/./src/utils/Errors.ts","webpack://leancoffee-powerup/./src/utils/Scope.ts","webpack://leancoffee-powerup/./src/storage/Storage.ts","webpack://leancoffee-powerup/./src/storage/BoardStorage.ts","webpack://leancoffee-powerup/./src/storage/CardStorage.ts","webpack://leancoffee-powerup/./src/storage/MemberStorage.ts","webpack://leancoffee-powerup/./src/LeanCoffeeBase.ts","webpack://leancoffee-powerup/./src/utils/I18nConfig.ts","webpack://leancoffee-powerup/./src/LeanCoffeeIFrame.ts","webpack://leancoffee-powerup/./src/settings.ts","webpack://leancoffee-powerup/./src/LeanCoffeeSettings.ts"],"sourcesContent":["import BoardStorage from \"../storage/BoardStorage\";\nimport Trello from \"../types/trellopowerup/index\";\n\nconst getTagsForReporting = async (boardStorage: BoardStorage, t: Trello.PowerUp.CallbackHandler): Promise<string> => {\n  const organisationIdHash = await boardStorage.read<string>(t, BoardStorage.ORGANISATION_HASH);\n  const boardIdHash = await boardStorage.read<string>(t, BoardStorage.BOARD_HASH);\n  return `organisationIdHash=${organisationIdHash}&boardIdHash=${boardIdHash}`;\n};\n\nconst isRunningInProduction = (): boolean => (process.env.NODE_ENV as Environment) === \"production\";\n\nconst ErrorReporter = (target: any, methodName: string, descriptor: PropertyDescriptor) => {\n  const originalMethod = descriptor.value;\n  const isAsync = originalMethod.constructor.name === \"AsyncFunction\";\n  const warningMessage = `Leaner Coffee Power-Up: error in ${methodName} (reported)`;\n\n  if (isAsync) {\n    descriptor.value = async function (...args: any[]) {\n      try {\n        return await originalMethod.apply(this, args);\n      } catch (error) {\n        console.warn(warningMessage);\n        window.Sentry.captureException(error);\n      }\n    };\n  } else {\n    descriptor.value = function (...args: any[]) {\n      try {\n        return originalMethod.apply(this, args);\n      } catch (error) {\n        console.warn(warningMessage);\n        window.Sentry.captureException(error);\n      }\n    };\n  }\n\n  return descriptor;\n};\n\nfunction ErrorReporterInjector<T extends { new (...args: any[]): object }>(constructor: T) {\n  // Get all prototype methods\n  const prototype = constructor.prototype;\n  const methodNames = Object.getOwnPropertyNames(prototype).filter(\n    (name) => typeof prototype[name] === \"function\" && name !== \"constructor\", // Skip constructor\n  );\n\n  // Apply the ErrorReporter decorator to each method\n  methodNames.forEach((methodName) => {\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, methodName);\n    if (descriptor && typeof descriptor.value === \"function\") {\n      const decoratedDescriptor = ErrorReporter(prototype, methodName, descriptor);\n\n      // console.log(\n      //   `Decorating ${constructor.name}::${methodName} with ErrorReporter`,\n      // );\n      Object.defineProperty(prototype, methodName, decoratedDescriptor);\n    }\n  });\n\n  return constructor;\n}\n\nexport { getTagsForReporting, isRunningInProduction, ErrorReporter, ErrorReporterInjector };\n","const bindAll = (classInstance: any) => {\n  const p = classInstance.constructor.prototype;\n  const methodNames = Object.getOwnPropertyNames(p).filter(\n    (name) => typeof p[name] === \"function\" && name !== \"constructor\", // Skip constructor\n  );\n\n  methodNames.forEach((methodName) => (p[methodName] = p[methodName].bind(classInstance)));\n};\n\nexport { bindAll };\n","import Trello from \"../types/trellopowerup/index\";\nimport { Scope, Visibility } from \"../types/trellopowerup/lib/hosthandlers\";\nimport { ErrorReporterInjector } from \"../utils/Errors\";\nimport { bindAll } from \"../utils/Scope\";\n\ntype StorageMethodNames = \"set\" | \"remove\";\n\n// Define parameter types for each method overload explicitly\ntype StorageMethodParameters<T extends StorageMethodNames> = T extends \"set\"\n  ?\n      | [scope: Scope | string, visibility: Visibility, key: string, value: unknown]\n      | [scope: Scope | string, visibility: Visibility, entries: { [key: string]: unknown }]\n  : T extends \"remove\"\n    ?\n        | [scope: Scope | string, visibility: Visibility, key: string]\n        | [scope: Scope | string, visibility: Visibility, entries: string[]]\n    : never;\n\n@ErrorReporterInjector\nclass Storage {\n  scope: Trello.PowerUp.Scope;\n  visibility: Trello.PowerUp.Visibility;\n\n  constructor(scope: Trello.PowerUp.Scope = \"member\", visibility: Trello.PowerUp.Visibility = \"private\") {\n    Object.assign(this, { scope, visibility });\n    bindAll(this);\n  }\n\n  static async getMemberType(t: Trello.PowerUp.AnonymousHostHandlers): Promise<string> {\n    const board = await t.board(\"memberships\");\n    const currentMember = await t.member(\"id\");\n    const myMembership = board.memberships.find((m) => m.idMember === currentMember.id);\n    return myMembership ? myMembership.memberType : \"unknown\";\n  }\n\n  static notEnoughPrivileges(error: any): boolean {\n    return error instanceof Error && error.message.startsWith(\"Scope not editable by active member\");\n  }\n\n  async read<T>(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    key: string,\n    cardId?: string,\n  ): Promise<T> {\n    return await t.get(cardId ?? this.scope, this.visibility, key);\n  }\n\n  async execute<T extends StorageMethodNames>(\n    t: Trello.PowerUp.HostHandlers,\n    method: T,\n    ...args: StorageMethodParameters<T>\n  ): Promise<void> {\n    try {\n      return await (t[method] as any)(...args);\n    } catch (error) {\n      const context = t.getContext();\n      const errorMessage = error instanceof Error ? error.message : error.toString();\n\n      if (Storage.notEnoughPrivileges(error)) {\n        await t.alert({ message: t.localizeKey(\"notEnoughPermissions\") });\n      }\n\n      window.Sentry.captureException(new Error(\"Error while editing scope: \" + errorMessage), {\n        contexts: {\n          WriteOperation: {\n            scope: this.scope,\n            visibility: this.visibility,\n            memberType: await Storage.getMemberType(t),\n            permissions: context.permissions,\n          },\n        },\n      });\n    }\n  }\n\n  async write(t: Trello.PowerUp.HostHandlers, key: string, value: any, cardId?: string): Promise<void> {\n    await this.execute<\"set\">(t, \"set\", cardId ?? this.scope, this.visibility, key, value);\n  }\n\n  async writeMultiple(\n    t: Trello.PowerUp.HostHandlers,\n    entries: {\n      [key: string]: any;\n    },\n    cardId?: string,\n  ): Promise<void> {\n    await this.execute<\"set\">(t, \"set\", cardId ?? this.scope, this.visibility, entries);\n  }\n\n  async delete(t: Trello.PowerUp.HostHandlers, key: string, cardId?: string): Promise<void> {\n    await this.execute<\"remove\">(t, \"remove\", cardId ?? this.scope, this.visibility, key);\n  }\n\n  async deleteMultiple(t: Trello.PowerUp.HostHandlers, entries: string[], cardId?: string): Promise<void> {\n    await this.execute<\"remove\">(t, \"remove\", cardId ?? this.scope, this.visibility, entries);\n  }\n}\n\nexport default Storage;\n","import Storage from \"./Storage\";\n\nclass BoardStorage extends Storage {\n  static DISCUSSION_STATUS = \"leancoffeeDiscussionStatus\";\n  static DISCUSSION_CARD_ID = \"leancoffeeDiscussionCardId\";\n  static DISCUSSION_STARTED_AT = \"leancoffeeDiscussionStartedAt\";\n  static DISCUSSION_PREVIOUS_ELAPSED = \"leancoffeeDiscussionPreviousElapsed\";\n  static DISCUSSION_INTERVAL_ID = \"leancoffeeDiscussionIntervalId\";\n  static POWER_UP_INSTALLATION_DATE = \"powerUpInstallationDate\";\n  static ORGANISATION_HASH = \"organisationHash\";\n  static BOARD_HASH = \"boardHash\";\n\n  constructor() {\n    super(\"board\", \"shared\");\n  }\n}\n\nexport default BoardStorage;\n","import Storage from \"./Storage\";\n\nclass CardStorage extends Storage {\n  static DISCUSSION_STATUS = \"leancoffeeDiscussionStatus\";\n  static DISCUSSION_ELAPSED = \"leancoffeeDiscussionElapsed\";\n  static DISCUSSION_THUMBS = \"leancoffeeDiscussionThumbs\";\n  static VOTES = \"leancoffeeVotes\";\n  static DISCUSSION_BUTTON_LABEL = \"discussionButtonLabel\";\n\n  constructor() {\n    super(\"card\", \"shared\");\n  }\n}\n\nexport default CardStorage;\n","import Storage from \"./Storage\";\n\nclass MemberStorage extends Storage {\n  static POWER_UP_VERSION = \"powerUpVersion\";\n\n  constructor() {\n    super(\"member\", \"private\");\n  }\n}\n\nexport default MemberStorage;\n","import BoardStorage from \"./storage/BoardStorage\";\nimport CardStorage from \"./storage/CardStorage\";\nimport MemberStorage from \"./storage/MemberStorage\";\nimport Trello from \"./types/trellopowerup/index\";\nimport { ErrorReporterInjector } from \"./utils/Errors\";\nimport { bindAll } from \"./utils/Scope\";\n\nexport interface LeanCoffeeBaseParams {\n  w: Window;\n  config: Config;\n  t?: Trello.PowerUp.PowerUp | Trello.PowerUp.IFrame;\n}\n\n@ErrorReporterInjector\nexport class LeanCoffeeBase {\n  w: Window;\n  boardStorage: BoardStorage;\n  cardStorage: CardStorage;\n  memberStorage: MemberStorage;\n  config: Config;\n\n  constructor({ w, config }: LeanCoffeeBaseParams) {\n    this.w = w;\n    this.config = config;\n    this.boardStorage = new BoardStorage();\n    this.cardStorage = new CardStorage();\n    this.memberStorage = new MemberStorage();\n    bindAll(this);\n  }\n}\n","import Trello from \"../types/trellopowerup/index\";\n\nconst config: Config = process.env.CONFIG as unknown as Config;\nconst { supportedLocales } = config[process.env.NODE_ENV as Environment];\n\nexport const I18nConfig: Trello.L18N.Localization = {\n  defaultLocale: \"en\",\n  supportedLocales,\n  resourceUrl: \"/i18n/{locale}.json\",\n};\n","import { LeanCoffeeBase, LeanCoffeeBaseParams } from \"./LeanCoffeeBase\";\nimport BoardStorage from \"./storage/BoardStorage\";\nimport Trello from \"./types/trellopowerup/index\";\nimport { isRunningInProduction } from \"./utils/Errors\";\nimport { I18nConfig } from \"./utils/I18nConfig\";\n\nexport class LeanCoffeeIFrame extends LeanCoffeeBase {\n  t: Trello.PowerUp.IFrame;\n\n  constructor({ w, config }: LeanCoffeeBaseParams) {\n    super({ w, config });\n\n    this.t = w.TrelloPowerUp.iframe({\n      localization: I18nConfig,\n      helpfulStacks: !isRunningInProduction(),\n    });\n\n    Promise.all([\n      this.boardStorage.read<string>(this.t, BoardStorage.ORGANISATION_HASH),\n      this.boardStorage.read<string>(this.t, BoardStorage.BOARD_HASH),\n    ]).then(([organisationIdHash, boardIdHash]) => {\n      if (this.w.Sentry) {\n        this.w.Sentry.onLoad(async () => {\n          this.w.Sentry.setTags({\n            organisationIdHash: organisationIdHash,\n            boardIdHash: boardIdHash,\n          });\n        });\n      }\n    });\n  }\n}\n","import LeanCoffeeSettings from \"./LeanCoffeeSettings\";\n\nconst config: Config = process.env.CONFIG as unknown as Config;\n\nconst settings = new LeanCoffeeSettings({\n  w: window,\n  config,\n});\nsettings.init();\n","import { LeanCoffeeIFrame } from \"./LeanCoffeeIFrame\";\nimport Debug from \"./utils/Debug\";\nimport { isRunningInProduction } from \"./utils/Errors\";\n\nclass LeanCoffeeSettings extends LeanCoffeeIFrame {\n  init(): void {\n    if (!isRunningInProduction()) {\n      (this.w.document.querySelector(\".dev-only\") as HTMLElement).style.display = \"block\";\n      this.w.document.getElementById(\"showData\").addEventListener(\"click\", this.showData.bind(this));\n      this.w.document.getElementById(\"wipeData\").addEventListener(\"click\", this.wipeData.bind(this));\n    }\n\n    this.t.render(() => {\n      this.t.localizeNode(document.body);\n      this.t.sizeTo(\"#leanCoffeeSettingsForm\");\n    });\n  }\n\n  async showData(evt: Event): Promise<void> {\n    evt.preventDefault();\n    if (isRunningInProduction()) {\n      return;\n    }\n\n    await Debug.showData(this.t);\n  }\n\n  async wipeData(evt: Event): Promise<void> {\n    evt.preventDefault();\n    if (isRunningInProduction()) {\n      return;\n    }\n\n    await Debug.wipeData(this.t, this.cardStorage, this.boardStorage);\n  }\n}\n\nexport default LeanCoffeeSettings;\n"],"names":["ErrorReporter","target","methodName","descriptor","originalMethod","value","isAsync","constructor","name","warningMessage","async","args","apply","this","error","console","warn","window","Sentry","captureException","ErrorReporterInjector","prototype","Object","getOwnPropertyNames","filter","forEach","getOwnPropertyDescriptor","decoratedDescriptor","defineProperty","bindAll","classInstance","p","bind","Storage","scope","visibility","assign","getMemberType","t","board","currentMember","member","myMembership","memberships","find","m","idMember","id","memberType","notEnoughPrivileges","Error","message","startsWith","read","key","cardId","get","execute","method","context","getContext","errorMessage","toString","alert","localizeKey","contexts","WriteOperation","permissions","write","writeMultiple","entries","deleteMultiple","super","DISCUSSION_STATUS","DISCUSSION_CARD_ID","DISCUSSION_STARTED_AT","DISCUSSION_PREVIOUS_ELAPSED","DISCUSSION_INTERVAL_ID","POWER_UP_INSTALLATION_DATE","ORGANISATION_HASH","BOARD_HASH","CardStorage","DISCUSSION_ELAPSED","DISCUSSION_THUMBS","VOTES","DISCUSSION_BUTTON_LABEL","MemberStorage","POWER_UP_VERSION","LeanCoffeeBase","w","config","boardStorage","cardStorage","memberStorage","supportedLocales","I18nConfig","defaultLocale","resourceUrl","LeanCoffeeIFrame","TrelloPowerUp","iframe","localization","helpfulStacks","Promise","all","then","organisationIdHash","boardIdHash","onLoad","setTags","init","render","localizeNode","document","body","sizeTo","showData","evt","preventDefault","wipeData"],"sourceRoot":""}