try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="9bcd8358-ccb9-4d60-8d9d-7f2fef17076e",e._sentryDebugIdIdentifier="sentry-dbid-9bcd8358-ccb9-4d60-8d9d-7f2fef17076e")}catch(e){}!function(){var e={262:function(e){function t(e,t){t=t||2;let s=e.toString(),i=0;return i=t-s.length+1,s=new Array(i).join("0").concat(s),s}e.exports=function(e,s){const i=s&&s.leading,o=s&&s.ms,r=e<0?-e:e,n=function(e,t){return t?e<0?"-":"":e<=-1e3?"-":""}(e,o),a=function(e){if("number"!=typeof e)throw new TypeError("Expected a number");return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5)%24,minutes:Math.trunc(e/6e4)%60,seconds:Math.trunc(e/1e3)%60,ms:Math.trunc(e)%1e3}}(r),c=t(a.seconds);let d="";return a.days&&!d&&(d=n+a.days+":"+t(a.hours)+":"+t(a.minutes)+":"+c),a.hours&&!d&&(d=n+(i?t(a.hours):a.hours)+":"+t(a.minutes)+":"+c),d||(d=n+(i?t(a.minutes):a.minutes)+":"+c),o&&(d+="."+t(a.ms,3)),d}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=s(262),t=s.n(e);const i=(e,t,s)=>{const i=s.value,o="AsyncFunction"===i.constructor.name,r=`Leaner Coffee Power-Up: error in ${t} (reported)`;return s.value=o?async function(...e){try{return await i.apply(this,e)}catch(e){console.warn(r),window.Sentry.captureException(e)}}:function(...e){try{return i.apply(this,e)}catch(e){console.warn(r),window.Sentry.captureException(e)}},s};function o(e){const t=e.prototype;return Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((e=>{const s=Object.getOwnPropertyDescriptor(t,e);if(s&&"function"==typeof s.value){const o=i(0,e,s);Object.defineProperty(t,e,o)}})),e}const r=e=>{const t=e.constructor.prototype;Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((s=>t[s]=t[s].bind(e)))};var n=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let a=class{constructor(e="member",t="private"){Object.assign(this,{scope:e,visibility:t}),r(this)}canWrite(e){return"member"===this.scope||e.memberCanWriteToModel(this.scope)}async isObserver(e){const t=await e.board("memberships"),s=await e.member("id"),i=t.memberships.find((e=>e.idMember===s.id));return i&&"observer"===i.memberType}read(e,t,s){return e.get(s??this.scope,this.visibility,t)}async write(e,t,s,i){!("memberCanWriteToModel"in e)||this.canWrite(e)?await e.set(i??this.scope,this.visibility,t,s):window.Sentry.captureException(new Error("Error while editing scope"),{contexts:{WriteOperation:{scope:this.scope,visibility:this.visibility,key:t,hasCardId:!!i,isObserver:await this.isObserver(e)}}})}async writeMultiple(e,t,s){!("memberCanWriteToModel"in e)||this.canWrite(e)?await e.set(s??this.scope,this.visibility,t):window.Sentry.captureException(new Error("Error while editing scope"),{contexts:{WriteOperation:{scope:this.scope,visibility:this.visibility,key:t,hasCardId:!!s,isObserver:await this.isObserver(e)}}})}async delete(e,t,s){if(!("memberCanWriteToModel"in e)||this.canWrite(e))return e.remove(s??this.scope,this.visibility,t);window.Sentry.captureException(new Error("Error while editing scope"),{contexts:{DeleteOperation:{scope:this.scope,visibility:this.visibility,key:t,hasCardId:!!s,isObserver:await this.isObserver(e)}}})}async deleteMultiple(e,t,s){if(!("memberCanWriteToModel"in e)||this.canWrite(e))return e.remove(s??this.scope,this.visibility,t);window.Sentry.captureException(new Error("Error while editing scope"),{contexts:{DeleteOperation:{scope:this.scope,visibility:this.visibility,key:t,hasCardId:!!s,isObserver:await this.isObserver(e)}}})}};a=n([o],a);var c=a;class d extends c{constructor(){super("board","shared")}}d.DISCUSSION_STATUS="leancoffeeDiscussionStatus",d.DISCUSSION_CARD_ID="leancoffeeDiscussionCardId",d.DISCUSSION_STARTED_AT="leancoffeeDiscussionStartedAt",d.DISCUSSION_PREVIOUS_ELAPSED="leancoffeeDiscussionPreviousElapsed",d.DISCUSSION_INTERVAL_ID="leancoffeeDiscussionIntervalId",d.POWER_UP_INSTALLATION_DATE="powerUpInstallationDate",d.ORGANISATION_HASH="organisationHash",d.BOARD_HASH="boardHash";var l=d;class u extends c{constructor(){super("card","shared")}}u.DISCUSSION_STATUS="leancoffeeDiscussionStatus",u.DISCUSSION_ELAPSED="leancoffeeDiscussionElapsed",u.DISCUSSION_THUMBS="leancoffeeDiscussionThumbs",u.VOTES="leancoffeeVotes",u.DISCUSSION_BUTTON_LABEL="discussionButtonLabel";var h=u;class p extends c{constructor(){super("member","private")}}p.POWER_UP_VERSION="powerUpVersion";var g=p,S=function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n};let f=class{constructor({w:e,config:t}){this.w=e,this.config=t,this.boardStorage=new l,this.cardStorage=new h,this.memberStorage=new g,r(this)}};f=S([o],f);const{supportedLocales:b}={hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]},w={defaultLocale:"en",supportedLocales:b,resourceUrl:"/i18n/{locale}.json"};class y extends f{constructor({w:e,config:t}){super({w:e,config:t}),this.t=e.TrelloPowerUp.iframe({localization:w,helpfulStacks:!1}),Promise.all([this.boardStorage.read(this.t,l.ORGANISATION_HASH),this.boardStorage.read(this.t,l.BOARD_HASH)]).then((([e,t])=>{this.w.Sentry&&this.w.Sentry.onLoad((async()=>{this.w.Sentry.setTags({organisationIdHash:e,boardIdHash:t})}))}))}}const m=e=>{const t=new URL(e);return t.protocol+t.hostname+(t.port?`:${t.port}`:"")+t.pathname};var v,O={beforeSend:(e,t)=>({...t,referrer:window.LeanerCoffeeAnalyticsReferrer,hostname:window.LeanerCoffeeAnalyticsHostname,url:m(t.url)}),pageview:async(e,t={})=>{e.umami?await e.umami.track((e=>({...e,...t}))):console.warn("Umami not available for pageview",t)},event:async(e,t,s)=>{e.umami?await e.umami.track(t,s):console.warn("Umami not available for event "+t,s)},getOverrides:async(e,t)=>{const s=await e.read(t,l.ORGANISATION_HASH),i=await e.read(t,l.BOARD_HASH);return`referrer=${encodeURIComponent("https://"+s)}&hostname=${i}`}};!function(e){e.UP="UP",e.DOWN="DOWN",e.MIDDLE="MIDDLE"}(v||(v={}));var I=class extends y{constructor({w:e,config:t}){super({w:e,config:t}),this.toggleVoting=e=>{this.voting.forEach((t=>{t.style.visibility=e?"visible":"hidden"}))},this.badges=this.w.document.querySelector(".badges"),this.badgeElapsed=this.w.document.querySelector(".badge-elapsed"),this.badgeHeaderStatus=this.w.document.querySelector('[data-i18n-id="discussionUiStatus"]'),this.badgeHeaderWhatNext=this.w.document.querySelector('[data-i18n-id="discussionUiWhatNext"]'),this.messageNone=this.w.document.querySelector('[data-i18n-id="discussionUiMessageNone"]'),this.messageEnded=this.w.document.querySelector('[data-i18n-id="discussionUiMessageEnded"]'),this.voting=this.w.document.querySelectorAll(".voting")}init(){this.w.document.querySelector(".voting-up").addEventListener("click",(()=>this.handleThumbs("UP"))),this.w.document.querySelector(".voting-middle").addEventListener("click",(()=>this.handleThumbs("MIDDLE"))),this.w.document.querySelector(".voting-down").addEventListener("click",(()=>this.handleThumbs("DOWN"))),this.t.render((()=>{this.t.localizeNode(document.body),this.w.setTimeout((()=>this.t.sizeTo.call(this.t,"body")),100),this.monitorDiscussion(),this.w.clearInterval(this.intervalId),this.intervalId=this.w.setInterval(this.monitorDiscussion,1e3)}))}async monitorDiscussion(){const e=await this.cardStorage.read(this.t,h.DISCUSSION_STATUS),t=["ONGOING","PAUSED"].includes(e);if(!e||this.previousStatus!==e||t){switch(e){case"ENDED":this.toggleBadges(!1),this.toggleFields(".message","discussionUiMessageEnded");break;case"ONGOING":this.previousStatus!==e&&(this.toggleVoting(!1),this.toggleBadges(!0),this.toggleFields(".message",""),this.updateStatusHeader("ONGOING")),this.updateElapsed("ONGOING");break;case"PAUSED":this.previousStatus!==e&&(this.toggleFields(".message",""),this.toggleVoting(!0),this.toggleBadges(!0),this.updateStatusHeader("PAUSED"),this.updateElapsed("PAUSED")),this.updateThumbs();break;default:this.toggleBadges(!1),this.toggleVoting(!1),this.toggleFields(".message","discussionUiMessageNone")}this.previousStatus=e}}async updateElapsed(e){if("ONGOING"===e){const s=await this.boardStorage.read(this.t,l.DISCUSSION_STARTED_AT),i=await this.boardStorage.read(this.t,l.DISCUSSION_PREVIOUS_ELAPSED)||0,o=s?Date.now()-s:0,r=t()(o+i);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("paused"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionOngoing")} → ${r}`}else{const s=await this.cardStorage.read(this.t,h.DISCUSSION_ELAPSED);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("ongoing"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionElapsed")} → ${t()(s)}`}}async updateThumbs(){const e=await this.cardStorage.read(this.t,h.DISCUSSION_THUMBS)||{},t=this.t.getContext().member,s=e[t];Object.keys(v).forEach((t=>{const i=Object.keys(e).filter((s=>e[s]===t)).length,o=this.w.document.querySelector(`.voting-${t.toLowerCase()}`);o.innerText=i.toString(),t===s?o.classList.add("own"):o.classList.remove("own")}))}async handleThumbs(e){const t=await this.cardStorage.read(this.t,h.DISCUSSION_THUMBS)||{},s=this.t.getContext().member;return t[s]===e?(delete t[s],await O.event(this.w,"keepDiscussingVoted",{outcome:"removed",choice:e})):(t[s]=e,await O.event(this.w,"keepDiscussingVoted",{outcome:"added",choice:e})),this.cardStorage.write(this.t,h.DISCUSSION_THUMBS,t)}toggleBadges(e){this.badges.style.display=e?"grid":"none"}updateStatusHeader(e){"PAUSED"===e?this.toggleFields(".badge-header-text","discussionUiWhatNext"):this.toggleFields(".badge-header-text","discussionUiStatus")}toggleFields(e,t){this.w.document.querySelectorAll(e).forEach((e=>{const s=e.dataset.i18nId===t;e.style.display=s?"block":"none"}))}};new I({w:window,config:{production:{hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]}}}).init()}()}();
//# sourceMappingURL=discussion-ui.70f76dc5d265758de148.js.map