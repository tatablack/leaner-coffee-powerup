try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="51225fc7-cd91-405e-904e-b8615f86ff2c",e._sentryDebugIdIdentifier="sentry-dbid-51225fc7-cd91-405e-904e-b8615f86ff2c")}catch(e){}!function(){var e={262:function(e){function t(e,t){t=t||2;let s=e.toString(),i=0;return i=t-s.length+1,s=new Array(i).join("0").concat(s),s}e.exports=function(e,s){const i=s&&s.leading,r=s&&s.ms,n=e<0?-e:e,o=function(e,t){return t?e<0?"-":"":e<=-1e3?"-":""}(e,r),a=function(e){if("number"!=typeof e)throw new TypeError("Expected a number");return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5)%24,minutes:Math.trunc(e/6e4)%60,seconds:Math.trunc(e/1e3)%60,ms:Math.trunc(e)%1e3}}(n),c=t(a.seconds);let u="";return a.days&&!u&&(u=o+a.days+":"+t(a.hours)+":"+t(a.minutes)+":"+c),a.hours&&!u&&(u=o+(i?t(a.hours):a.hours)+":"+t(a.minutes)+":"+c),u||(u=o+(i?t(a.minutes):a.minutes)+":"+c),r&&(u+="."+t(a.ms,3)),u}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=s(262),t=s.n(e);const i=(e,t,s)=>{const i=s.value,r="AsyncFunction"===i.constructor.name,n=`Leaner Coffee Power-Up: error in ${t} (reported)`;return s.value=r?async function(...e){try{return await i.apply(this,e)}catch(e){console.warn(n),window.Sentry.captureException(e)}}:function(...e){try{return i.apply(this,e)}catch(e){console.warn(n),window.Sentry.captureException(e)}},s};function r(e){const t=e.prototype;return Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((e=>{const s=Object.getOwnPropertyDescriptor(t,e);if(s&&"function"==typeof s.value){const r=i(0,e,s);Object.defineProperty(t,e,r)}})),e}const n=e=>{const t=e.constructor.prototype;Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((s=>t[s]=t[s].bind(e)))};var o=function(e,t,s,i){var r,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,s,o):r(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o};let a=class{constructor(e="member",t="private"){Object.assign(this,{scope:e,visibility:t}),n(this)}read(e,t,s){return e.get(s??this.scope,this.visibility,t)}write(e,t,s,i){return e.set(i??this.scope,this.visibility,t,s)}writeMultiple(e,t,s){return e.set(s??this.scope,this.visibility,t)}delete(e,t,s){return e.remove(s??this.scope,this.visibility,t)}deleteMultiple(e,t,s){return e.remove(s??this.scope,this.visibility,t)}};a=o([r],a);var c=a;class u extends c{constructor(){super("board","shared")}async getDiscussionStatus(e){return super.read(e,u.DISCUSSION_STATUS)}async getDiscussionCardId(e){return super.read(e,u.DISCUSSION_CARD_ID)}async getDiscussionStartedAt(e){return super.read(e,u.DISCUSSION_STARTED_AT)}async getDiscussionPreviousElapsed(e){return super.read(e,u.DISCUSSION_PREVIOUS_ELAPSED)}async getDiscussionIntervalId(e){return super.read(e,u.DISCUSSION_INTERVAL_ID)}async getPowerUpInstallationDate(e){return super.read(e,u.POWER_UP_INSTALLATION_DATE)}async getOrganisationIdHash(e){return super.read(e,u.ORGANISATION_HASH)}async setOrganisationIdHash(e,t){return super.write(e,u.ORGANISATION_HASH,t)}async getBoardIdHash(e){return super.read(e,u.BOARD_HASH)}async setBoardIdHash(e,t){return super.write(e,u.BOARD_HASH,t)}async getInitialised(e){return!!await super.read(e,u.POWER_UP_INSTALLATION_DATE)}setPowerUpInstallationDate(e,t){return super.write(e,u.POWER_UP_INSTALLATION_DATE,t)}}u.DISCUSSION_STATUS="leancoffeeDiscussionStatus",u.DISCUSSION_CARD_ID="leancoffeeDiscussionCardId",u.DISCUSSION_STARTED_AT="leancoffeeDiscussionStartedAt",u.DISCUSSION_PREVIOUS_ELAPSED="leancoffeeDiscussionPreviousElapsed",u.DISCUSSION_INTERVAL_ID="leancoffeeDiscussionIntervalId",u.POWER_UP_INSTALLATION_DATE="powerUpInstallationDate",u.ORGANISATION_HASH="organisationHash",u.BOARD_HASH="boardHash";var d=u;class l extends c{constructor(){super("card","shared")}getDiscussionStatus(e){return super.read(e,l.DISCUSSION_STATUS)}getDiscussionElapsed(e){return super.read(e,l.DISCUSSION_ELAPSED)}getDiscussionThumbs(e){return super.read(e,l.DISCUSSION_THUMBS)}getDiscussionButtonLabel(e){return super.read(e,l.DISCUSSION_BUTTON_LABEL)}saveDiscussionStatus(e,t,s){return super.write(e,l.DISCUSSION_STATUS,t,s)}saveDiscussionElapsed(e,t,s){return super.write(e,l.DISCUSSION_ELAPSED,t,s)}saveDiscussionThumbs(e,t){return super.write(e,l.DISCUSSION_THUMBS,t)}saveVotes(e,t){return super.write(e,l.VOTES,t)}deleteVotes(e){return super.delete(e,l.VOTES)}saveDiscussionButtonLabel(e,t){return super.write(e,l.DISCUSSION_BUTTON_LABEL,t)}deleteDiscussionThumbs(e){return super.delete(e,l.DISCUSSION_THUMBS)}}l.DISCUSSION_STATUS="leancoffeeDiscussionStatus",l.DISCUSSION_ELAPSED="leancoffeeDiscussionElapsed",l.DISCUSSION_THUMBS="leancoffeeDiscussionThumbs",l.VOTES="leancoffeeVotes",l.DISCUSSION_BUTTON_LABEL="discussionButtonLabel";var h=l;class S extends c{constructor(){super("member","private")}}S.POWER_UP_VERSION="powerUpVersion";var g=S,p=function(e,t,s,i){var r,n=arguments.length,o=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(n<3?r(o):n>3?r(t,s,o):r(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o};let f=class{constructor({w:e,config:t}){this.w=e,this.config=t,this.boardStorage=new d,this.cardStorage=new h,this.memberStorage=new g,n(this)}};f=p([r],f);const{supportedLocales:I}={hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]},D={defaultLocale:"en",supportedLocales:I,resourceUrl:"/i18n/{locale}.json"};class w extends f{constructor({w:e,config:t}){super({w:e,config:t}),this.t=e.TrelloPowerUp.iframe({localization:D,helpfulStacks:!1}),Promise.all([this.boardStorage.getOrganisationIdHash(this.t),this.boardStorage.getBoardIdHash(this.t)]).then((([e,t])=>{this.w.Sentry&&this.w.Sentry.onLoad((async()=>{this.w.Sentry.setTags({organisationIdHash:e,boardIdHash:t})}))}))}}const y=e=>{const t=new URL(e);return t.protocol+t.hostname+(t.port?`:${t.port}`:"")+t.pathname};var b,m={beforeSend:(e,t)=>({...t,referrer:window.LeanerCoffeeAnalyticsReferrer,hostname:window.LeanerCoffeeAnalyticsHostname,url:y(t.url)}),pageview:async(e,t={})=>{e.umami?await e.umami.track((e=>({...e,...t}))):console.warn("Umami not available for pageview",t)},event:async(e,t,s)=>{e.umami?await e.umami.track(t,s):console.warn("Umami not available for event "+t,s)},getOverrides:async(e,t)=>{const s=await e.getOrganisationIdHash(t),i=await e.getBoardIdHash(t);return`referrer=${encodeURIComponent("https://"+s)}&hostname=${i}`}};!function(e){e.UP="UP",e.DOWN="DOWN",e.MIDDLE="MIDDLE"}(b||(b={}));var O=class extends w{constructor({w:e,config:t}){super({w:e,config:t}),this.toggleVoting=e=>{this.voting.forEach((t=>{t.style.visibility=e?"visible":"hidden"}))},this.badges=this.w.document.querySelector(".badges"),this.badgeElapsed=this.w.document.querySelector(".badge-elapsed"),this.badgeHeaderStatus=this.w.document.querySelector('[data-i18n-id="discussionUiStatus"]'),this.badgeHeaderWhatNext=this.w.document.querySelector('[data-i18n-id="discussionUiWhatNext"]'),this.messageNone=this.w.document.querySelector('[data-i18n-id="discussionUiMessageNone"]'),this.messageEnded=this.w.document.querySelector('[data-i18n-id="discussionUiMessageEnded"]'),this.voting=this.w.document.querySelectorAll(".voting")}init(){this.w.document.querySelector(".voting-up").addEventListener("click",(()=>this.handleThumbs("UP"))),this.w.document.querySelector(".voting-middle").addEventListener("click",(()=>this.handleThumbs("MIDDLE"))),this.w.document.querySelector(".voting-down").addEventListener("click",(()=>this.handleThumbs("DOWN"))),this.t.render((()=>{this.t.localizeNode(document.body),this.w.setTimeout((()=>this.t.sizeTo.call(this.t,"body")),100),this.monitorDiscussion(),this.w.clearInterval(this.intervalId),this.intervalId=this.w.setInterval(this.monitorDiscussion,1e3)}))}async monitorDiscussion(){const e=await this.cardStorage.getDiscussionStatus(this.t),t=["ONGOING","PAUSED"].includes(e);if(!e||this.previousStatus!==e||t){switch(e){case"ENDED":this.toggleBadges(!1),this.toggleFields(".message","discussionUiMessageEnded");break;case"ONGOING":this.previousStatus!==e&&(this.toggleVoting(!1),this.toggleBadges(!0),this.toggleFields(".message",""),this.updateStatusHeader("ONGOING")),this.updateElapsed("ONGOING");break;case"PAUSED":this.previousStatus!==e&&(this.toggleFields(".message",""),this.toggleVoting(!0),this.toggleBadges(!0),this.updateStatusHeader("PAUSED"),this.updateElapsed("PAUSED")),this.updateThumbs();break;default:this.toggleBadges(!1),this.toggleVoting(!1),this.toggleFields(".message","discussionUiMessageNone")}this.previousStatus=e}}async updateElapsed(e){if("ONGOING"===e){const s=await this.boardStorage.getDiscussionStartedAt(this.t),i=await this.boardStorage.getDiscussionPreviousElapsed(this.t)||0,r=s?Date.now()-s:0,n=t()(r+i);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("paused"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionOngoing")} → ${n}`}else{const s=await this.cardStorage.getDiscussionElapsed(this.t);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("ongoing"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionElapsed")} → ${t()(s)}`}}async updateThumbs(){const e=await this.cardStorage.getDiscussionThumbs(this.t)||{},t=this.t.getContext().member,s=e[t];Object.keys(b).forEach((t=>{const i=Object.keys(e).filter((s=>e[s]===t)).length,r=this.w.document.querySelector(`.voting-${t.toLowerCase()}`);r.innerText=i.toString(),t===s?r.classList.add("own"):r.classList.remove("own")}))}async handleThumbs(e){const t=await this.cardStorage.getDiscussionThumbs(this.t)||{},s=this.t.getContext().member;return t[s]===e?(delete t[s],await m.event(this.w,"keepDiscussingVoted",{outcome:"removed",choice:e})):(t[s]=e,await m.event(this.w,"keepDiscussingVoted",{outcome:"added",choice:e})),this.cardStorage.saveDiscussionThumbs(this.t,t)}toggleBadges(e){this.badges.style.display=e?"grid":"none"}updateStatusHeader(e){"PAUSED"===e?this.toggleFields(".badge-header-text","discussionUiWhatNext"):this.toggleFields(".badge-header-text","discussionUiStatus")}toggleFields(e,t){this.w.document.querySelectorAll(e).forEach((e=>{const s=e.dataset.i18nId===t;e.style.display=s?"block":"none"}))}};new O({w:window,config:{production:{hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]}}}).init()}()}();
//# sourceMappingURL=discussion-ui.158eeef00562167f1532.js.map