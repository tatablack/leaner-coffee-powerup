try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="894ae405-6650-4192-a3c5-fa0a7898b181",e._sentryDebugIdIdentifier="sentry-dbid-894ae405-6650-4192-a3c5-fa0a7898b181")}catch(e){}!function(){var e={262:function(e){function t(e,t){t=t||2;let s=e.toString(),i=0;return i=t-s.length+1,s=new Array(i).join("0").concat(s),s}e.exports=function(e,s){const i=s&&s.leading,o=s&&s.ms,a=e<0?-e:e,n=function(e,t){return t?e<0?"-":"":e<=-1e3?"-":""}(e,o),r=function(e){if("number"!=typeof e)throw new TypeError("Expected a number");return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5)%24,minutes:Math.trunc(e/6e4)%60,seconds:Math.trunc(e/1e3)%60,ms:Math.trunc(e)%1e3}}(a),c=t(r.seconds);let d="";return r.days&&!d&&(d=n+r.days+":"+t(r.hours)+":"+t(r.minutes)+":"+c),r.hours&&!d&&(d=n+(i?t(r.hours):r.hours)+":"+t(r.minutes)+":"+c),d||(d=n+(i?t(r.minutes):r.minutes)+":"+c),o&&(d+="."+t(r.ms,3)),d}}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=s(262),t=s.n(e);const i=(e,t,s)=>{const i=s.value,o="AsyncFunction"===i.constructor.name,a=`Leaner Coffee Power-Up: error in ${t} (reported)`;return s.value=o?async function(...e){try{return await i.apply(this,e)}catch(e){console.warn(a),window.Sentry.captureException(e)}}:function(...e){try{return i.apply(this,e)}catch(e){console.warn(a),window.Sentry.captureException(e)}},s};function o(e){const t=e.prototype;return Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((e=>{const s=Object.getOwnPropertyDescriptor(t,e);if(s&&"function"==typeof s.value){const o=i(0,e,s);Object.defineProperty(t,e,o)}})),e}const a=e=>{const t=e.constructor.prototype;Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).forEach((s=>t[s]=t[s].bind(e)))};var n,r=function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let c=n=class{constructor(e="member",t="private"){Object.assign(this,{scope:e,visibility:t}),a(this)}static async getMemberType(e){const t=await e.board("memberships"),s=await e.member("id"),i=t.memberships.find((e=>e.idMember===s.id));return i?i.memberType:"unknown"}static notEnoughPrivileges(e){return e instanceof Error&&e.message.startsWith("Scope not editable by active member")}async read(e,t,s){return await e.get(s??this.scope,this.visibility,t)}async execute(e,t,...s){try{return await e[t](...s)}catch(t){const s=e.getContext(),i=t instanceof Error?t.message:t.toString();n.notEnoughPrivileges(t)&&await e.alert({message:e.localizeKey("notEnoughPermissions")}),window.Sentry.captureException(new Error("Error while editing scope: "+i),{contexts:{WriteOperation:{scope:this.scope,visibility:this.visibility,memberType:await n.getMemberType(e),permissions:s.permissions}}})}}async write(e,t,s,i){await this.execute(e,"set",i??this.scope,this.visibility,t,s)}async writeMultiple(e,t,s){await this.execute(e,"set",s??this.scope,this.visibility,t)}async delete(e,t,s){await this.execute(e,"remove",s??this.scope,this.visibility,t)}async deleteMultiple(e,t,s){await this.execute(e,"remove",s??this.scope,this.visibility,t)}};c=n=r([o],c);var d=c;class l extends d{constructor(){super("board","shared")}}l.DISCUSSION_STATUS="leancoffeeDiscussionStatus",l.DISCUSSION_CARD_ID="leancoffeeDiscussionCardId",l.DISCUSSION_STARTED_AT="leancoffeeDiscussionStartedAt",l.DISCUSSION_PREVIOUS_ELAPSED="leancoffeeDiscussionPreviousElapsed",l.DISCUSSION_INTERVAL_ID="leancoffeeDiscussionIntervalId",l.POWER_UP_INSTALLATION_DATE="powerUpInstallationDate",l.ORGANISATION_HASH="organisationHash",l.BOARD_HASH="boardHash";var u=l;class h extends d{constructor(){super("card","shared")}}h.DISCUSSION_STATUS="leancoffeeDiscussionStatus",h.DISCUSSION_ELAPSED="leancoffeeDiscussionElapsed",h.DISCUSSION_THUMBS="leancoffeeDiscussionThumbs",h.VOTES="leancoffeeVotes",h.DISCUSSION_BUTTON_LABEL="discussionButtonLabel";var g=h;class p extends d{constructor(){super("member","private")}}p.POWER_UP_VERSION="powerUpVersion";var S=p,f=function(e,t,s,i){var o,a=arguments.length,n=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(a<3?o(n):a>3?o(t,s,n):o(t,s))||n);return a>3&&n&&Object.defineProperty(t,s,n),n};let w=class{constructor({w:e,config:t}){this.w=e,this.config=t,this.boardStorage=new u,this.cardStorage=new g,this.memberStorage=new S,a(this)}};w=f([o],w);const{supportedLocales:m}={hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]},y={defaultLocale:"en",supportedLocales:m,resourceUrl:"/i18n/{locale}.json"};class b extends w{constructor({w:e,config:t}){super({w:e,config:t}),this.t=e.TrelloPowerUp.iframe({localization:y,helpfulStacks:!1}),Promise.all([this.boardStorage.read(this.t,u.ORGANISATION_HASH),this.boardStorage.read(this.t,u.BOARD_HASH)]).then((([e,t])=>{this.w.Sentry&&this.w.Sentry.onLoad((async()=>{this.w.Sentry.setTags({organisationIdHash:e,boardIdHash:t})}))}))}}const I=e=>{const t=new URL(e);return t.protocol+t.hostname+(t.port?`:${t.port}`:"")+t.pathname};var v,D={beforeSend:(e,t)=>({...t,referrer:window.LeanerCoffeeAnalyticsReferrer,hostname:window.LeanerCoffeeAnalyticsHostname,url:I(t.url)}),pageview:async(e,t={})=>{e.umami?await e.umami.track((e=>({...e,...t}))):console.warn("Umami not available for pageview",t)},event:async(e,t,s)=>{e.umami?await e.umami.track(t,s):console.warn("Umami not available for event "+t,s)},getOverrides:async(e,t)=>{const s=await e.read(t,u.ORGANISATION_HASH),i=await e.read(t,u.BOARD_HASH);return`referrer=${encodeURIComponent("https://"+s)}&hostname=${i}`}};!function(e){e.UP="UP",e.DOWN="DOWN",e.MIDDLE="MIDDLE"}(v||(v={}));var O=class extends b{constructor({w:e,config:t}){super({w:e,config:t}),this.toggleVoting=e=>{this.voting.forEach((t=>{t.style.visibility=e?"visible":"hidden"}))},this.badges=this.w.document.querySelector(".badges"),this.badgeElapsed=this.w.document.querySelector(".badge-elapsed"),this.badgeHeaderStatus=this.w.document.querySelector('[data-i18n-id="discussionUiStatus"]'),this.badgeHeaderWhatNext=this.w.document.querySelector('[data-i18n-id="discussionUiWhatNext"]'),this.messageNone=this.w.document.querySelector('[data-i18n-id="discussionUiMessageNone"]'),this.messageEnded=this.w.document.querySelector('[data-i18n-id="discussionUiMessageEnded"]'),this.voting=this.w.document.querySelectorAll(".voting")}init(){this.w.document.querySelector(".voting-up").addEventListener("click",(()=>this.handleThumbs("UP"))),this.w.document.querySelector(".voting-middle").addEventListener("click",(()=>this.handleThumbs("MIDDLE"))),this.w.document.querySelector(".voting-down").addEventListener("click",(()=>this.handleThumbs("DOWN"))),this.t.render((()=>{this.t.localizeNode(document.body),this.w.setTimeout((()=>this.t.sizeTo.call(this.t,"body")),100),this.monitorDiscussion(),this.w.clearInterval(this.intervalId),this.intervalId=this.w.setInterval(this.monitorDiscussion,1e3)}))}async monitorDiscussion(){const e=await this.cardStorage.read(this.t,g.DISCUSSION_STATUS),t=["ONGOING","PAUSED"].includes(e);if(!e||this.previousStatus!==e||t){switch(e){case"ENDED":this.toggleBadges(!1),this.toggleFields(".message","discussionUiMessageEnded");break;case"ONGOING":this.previousStatus!==e&&(this.toggleVoting(!1),this.toggleBadges(!0),this.toggleFields(".message",""),this.updateStatusHeader("ONGOING")),await this.updateElapsed("ONGOING");break;case"PAUSED":this.previousStatus!==e&&(this.toggleFields(".message",""),this.toggleVoting(!0),this.toggleBadges(!0),this.updateStatusHeader("PAUSED"),await this.updateElapsed("PAUSED")),this.updateThumbs();break;default:this.toggleBadges(!1),this.toggleVoting(!1),this.toggleFields(".message","discussionUiMessageNone")}this.previousStatus=e}}async updateElapsed(e){if("ONGOING"===e){const s=await this.boardStorage.read(this.t,u.DISCUSSION_STARTED_AT),i=await this.boardStorage.read(this.t,u.DISCUSSION_PREVIOUS_ELAPSED)||0,o=s?Date.now()-s:0,a=t()(o+i);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("paused"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionOngoing")} → ${a}`}else{const s=await this.cardStorage.read(this.t,g.DISCUSSION_ELAPSED);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("ongoing"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionElapsed")} → ${t()(s)}`}}async updateThumbs(){const e=await this.cardStorage.read(this.t,g.DISCUSSION_THUMBS)||{},t=this.t.getContext().member,s=e[t];Object.keys(v).forEach((t=>{const i=Object.keys(e).filter((s=>e[s]===t)).length,o=this.w.document.querySelector(`.voting-${t.toLowerCase()}`);o.innerText=i.toString(),t===s?o.classList.add("own"):o.classList.remove("own")}))}async handleThumbs(e){const t=await this.cardStorage.read(this.t,g.DISCUSSION_THUMBS)||{},s=this.t.getContext().member;let i;t[s]===e?(delete t[s],i="removed"):(t[s]=e,i="added"),await this.cardStorage.write(this.t,g.DISCUSSION_THUMBS,t),await D.event(this.w,"keepDiscussingVoted",{outcome:i,choice:e})}toggleBadges(e){this.badges.style.display=e?"grid":"none"}updateStatusHeader(e){"PAUSED"===e?this.toggleFields(".badge-header-text","discussionUiWhatNext"):this.toggleFields(".badge-header-text","discussionUiStatus")}toggleFields(e,t){this.w.document.querySelectorAll(e).forEach((e=>{const s=e.dataset.i18nId===t;e.style.display=s?"block":"none"}))}};new O({w:window,config:{production:{hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]}}}).init()}()}();
//# sourceMappingURL=discussion-ui.bffe066899ea16e8eaea.js.map