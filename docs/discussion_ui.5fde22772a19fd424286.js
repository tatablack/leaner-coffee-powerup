!function(){var e={836:function(e){function s(e,s){s=s||2;let t=e.toString(),i=0;return i=s-t.length+1,t=new Array(i).join("0").concat(t),t}e.exports=function(e,t){const i=t&&t.leading,n=t&&t.ms,r=e<0?-e:e,o=function(e,s){return s?e<0?"-":"":e<=-1e3?"-":""}(e,n),a=function(e){if("number"!=typeof e)throw new TypeError("Expected a number");return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5)%24,minutes:Math.trunc(e/6e4)%60,seconds:Math.trunc(e/1e3)%60,ms:Math.trunc(e)%1e3}}(r),u=s(a.seconds);let c="";return a.days&&!c&&(c=o+a.days+":"+s(a.hours)+":"+s(a.minutes)+":"+u),a.hours&&!c&&(c=o+(i?s(a.hours):a.hours)+":"+s(a.minutes)+":"+u),c||(c=o+(i?s(a.minutes):a.minutes)+":"+u),n&&(c+="."+s(a.ms,3)),c}}},s={};function t(i){var n=s[i];if(void 0!==n)return n.exports;var r=s[i]={exports:{}};return e[i](r,r.exports,t),r.exports}t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,{a:s}),s},t.d=function(e,s){for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},function(){"use strict";var e=t(836),s=t.n(e);var i=class{constructor(e="member",s="private"){Object.assign(this,{scope:e,visibility:s})}read(e,s,t){return e.get(t??this.scope,this.visibility,s)}write(e,s,t,i){return e.set(i??this.scope,this.visibility,s,t)}writeMultiple(e,s,t){return e.set(t??this.scope,this.visibility,s)}delete(e,s,t){return e.remove(t??this.scope,this.visibility,s)}deleteMultiple(e,s,t){return e.remove(t??this.scope,this.visibility,s)}};class n extends i{constructor(){super("board","shared")}async getDiscussionStatus(e){return super.read(e,n.DISCUSSION_STATUS)}async getDiscussionCardId(e){return super.read(e,n.DISCUSSION_CARD_ID)}async getDiscussionStartedAt(e){return super.read(e,n.DISCUSSION_STARTED_AT)}async getDiscussionPreviousElapsed(e){return super.read(e,n.DISCUSSION_PREVIOUS_ELAPSED)}async getDiscussionIntervalId(e){return super.read(e,n.DISCUSSION_INTERVAL_ID)}async getPowerUpVersion(e){return super.read(e,n.POWER_UP_VERSION)}setPowerUpVersion(e,s){return super.write(e,n.POWER_UP_VERSION,s)}}n.DISCUSSION_STATUS="leancoffeeDiscussionStatus",n.DISCUSSION_CARD_ID="leancoffeeDiscussionCardId",n.DISCUSSION_STARTED_AT="leancoffeeDiscussionStartedAt",n.DISCUSSION_PREVIOUS_ELAPSED="leancoffeeDiscussionPreviousElapsed",n.DISCUSSION_INTERVAL_ID="leancoffeeDiscussionIntervalId",n.POWER_UP_VERSION="powerUpVersion";var r=n;class o extends i{constructor(){super("card","shared")}getDiscussionStatus(e){return super.read(e,o.DISCUSSION_STATUS)}getDiscussionElapsed(e){return super.read(e,o.DISCUSSION_ELAPSED)}getDiscussionThumbs(e){return super.read(e,o.DISCUSSION_THUMBS)}getDiscussionButtonLabel(e){return super.read(e,o.DISCUSSION_BUTTON_LABEL)}saveDiscussionStatus(e,s,t){return super.write(e,o.DISCUSSION_STATUS,s,t)}saveDiscussionElapsed(e,s,t){return super.write(e,o.DISCUSSION_ELAPSED,s,t)}saveDiscussionThumbs(e,s){return super.write(e,o.DISCUSSION_THUMBS,s)}saveVotes(e,s){return super.write(e,o.VOTES,s)}deleteVotes(e){return super.delete(e,o.VOTES)}saveDiscussionButtonLabel(e,s){return super.write(e,o.DISCUSSION_BUTTON_LABEL,s)}deleteDiscussionThumbs(e){return super.delete(e,o.DISCUSSION_THUMBS)}}o.DISCUSSION_STATUS="leancoffeeDiscussionStatus",o.DISCUSSION_ELAPSED="leancoffeeDiscussionElapsed",o.DISCUSSION_THUMBS="leancoffeeDiscussionThumbs",o.VOTES="leancoffeeVotes",o.DISCUSSION_BUTTON_LABEL="discussionButtonLabel";var a=o;class u{constructor({w:e,config:s}){this.isRunningInProduction=()=>!0,this.w=e,this.config=s,this.boardStorage=new r,this.cardStorage=new a}}const{supportedLocales:c}={hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]},d={defaultLocale:"en",supportedLocales:c,resourceUrl:"/i18n/{locale}.json"};var l;!function(e){e.UP="UP",e.DOWN="DOWN",e.MIDDLE="MIDDLE"}(l||(l={}));var h=class extends u{constructor({w:e,config:t}){super({w:e,config:t}),this.monitorDiscussion=async()=>{const e=await this.cardStorage.getDiscussionStatus(this.t),s=["ONGOING","PAUSED"].includes(e);if(!e||this.previousStatus!==e||s){switch(e){case"ENDED":this.toggleBadges(!1),this.toggleFields(".message","discussionUiMessageEnded");break;case"ONGOING":this.previousStatus!==e&&(this.toggleVoting(!1),this.toggleBadges(!0),this.toggleFields(".message",""),this.updateStatusHeader("ONGOING")),this.updateElapsed("ONGOING");break;case"PAUSED":this.previousStatus!==e&&(this.toggleFields(".message",""),this.toggleVoting(!0),this.toggleBadges(!0),this.updateStatusHeader("PAUSED"),this.updateElapsed("PAUSED")),this.updateThumbs();break;default:this.toggleBadges(!1),this.toggleVoting(!1),this.toggleFields(".message","discussionUiMessageNone")}this.previousStatus=e}},this.updateElapsed=async e=>{if("ONGOING"===e){const t=await this.boardStorage.getDiscussionStartedAt(this.t),i=await this.boardStorage.getDiscussionPreviousElapsed(this.t)||0,n=t?Date.now()-t:0,r=s()(n+i);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("paused"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionOngoing")} → ${r}`}else{const t=await this.cardStorage.getDiscussionElapsed(this.t);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("ongoing"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionElapsed")} → ${s()(t)}`}},this.updateThumbs=async()=>{const e=await this.cardStorage.getDiscussionThumbs(this.t)||{},s=this.t.getContext().member,t=e[s];Object.keys(l).forEach((s=>{const i=Object.keys(e).filter((t=>e[t]===s)).length,n=this.w.document.querySelector(`.voting-${s.toLowerCase()}`);n.innerText=i.toString(),s===t?n.classList.add("own"):n.classList.remove("own")}))},this.handleThumbs=async e=>{const s=await this.cardStorage.getDiscussionThumbs(this.t)||{},t=this.t.getContext().member;return s[t]===e?delete s[t]:s[t]=e,this.cardStorage.saveDiscussionThumbs(this.t,s)},this.toggleBadges=e=>{this.badges.style.display=e?"grid":"none"},this.toggleVoting=e=>{this.voting.forEach((s=>{s.style.visibility=e?"visible":"hidden"}))},this.updateStatusHeader=e=>{"PAUSED"===e?this.toggleFields(".badge-header-text","discussionUiWhatNext"):this.toggleFields(".badge-header-text","discussionUiStatus")},this.toggleFields=(e,s)=>{this.w.document.querySelectorAll(e).forEach((e=>{const t=e.dataset.i18nId===s;e.style.display=t?"block":"none"}))},this.t=e.TrelloPowerUp.iframe({localization:d,helpfulStacks:!this.isRunningInProduction()}),this.badges=this.w.document.querySelector(".badges"),this.badgeElapsed=this.w.document.querySelector(".badge-elapsed"),this.badgeHeaderStatus=this.w.document.querySelector('[data-i18n-id="discussionUiStatus"]'),this.badgeHeaderWhatNext=this.w.document.querySelector('[data-i18n-id="discussionUiWhatNext"]'),this.messageNone=this.w.document.querySelector('[data-i18n-id="discussionUiMessageNone"]'),this.messageEnded=this.w.document.querySelector('[data-i18n-id="discussionUiMessageEnded"]'),this.voting=this.w.document.querySelectorAll(".voting")}init(){this.w.document.querySelector(".voting-up").addEventListener("click",(()=>this.handleThumbs("UP"))),this.w.document.querySelector(".voting-middle").addEventListener("click",(()=>this.handleThumbs("MIDDLE"))),this.w.document.querySelector(".voting-down").addEventListener("click",(()=>this.handleThumbs("DOWN"))),this.t.render((()=>{this.t.localizeNode(document.body),this.w.setTimeout((()=>this.t.sizeTo.call(this.t,"body")),100),this.monitorDiscussion(),this.w.clearInterval(this.intervalId),this.intervalId=this.w.setInterval(this.monitorDiscussion,1e3)}))}};new h({w:window,config:{production:{hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]}}}).init()}()}();
//# sourceMappingURL=discussion_ui.5fde22772a19fd424286.js.map