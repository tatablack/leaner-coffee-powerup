!function(){var e={262:function(e){function t(e,t){t=t||2;let s=e.toString(),i=0;return i=t-s.length+1,s=new Array(i).join("0").concat(s),s}e.exports=function(e,s){const i=s&&s.leading,a=s&&s.ms,r=e<0?-e:e,n=function(e,t){return t?e<0?"-":"":e<=-1e3?"-":""}(e,a),o=function(e){if("number"!=typeof e)throw new TypeError("Expected a number");return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5)%24,minutes:Math.trunc(e/6e4)%60,seconds:Math.trunc(e/1e3)%60,ms:Math.trunc(e)%1e3}}(r),u=t(o.seconds);let c="";return o.days&&!c&&(c=n+o.days+":"+t(o.hours)+":"+t(o.minutes)+":"+u),o.hours&&!c&&(c=n+(i?t(o.hours):o.hours)+":"+t(o.minutes)+":"+u),c||(c=n+(i?t(o.minutes):o.minutes)+":"+u),a&&(c+="."+t(o.ms,3)),c}}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=s(262),t=s.n(e);var i=class{constructor(e="member",t="private"){Object.assign(this,{scope:e,visibility:t})}read(e,t,s){return e.get(s??this.scope,this.visibility,t)}write(e,t,s,i){return e.set(i??this.scope,this.visibility,t,s)}writeMultiple(e,t,s){return e.set(s??this.scope,this.visibility,t)}delete(e,t,s){return e.remove(s??this.scope,this.visibility,t)}deleteMultiple(e,t,s){return e.remove(s??this.scope,this.visibility,t)}};class a extends i{constructor(){super("board","shared")}async getDiscussionStatus(e){return super.read(e,a.DISCUSSION_STATUS)}async getDiscussionCardId(e){return super.read(e,a.DISCUSSION_CARD_ID)}async getDiscussionStartedAt(e){return super.read(e,a.DISCUSSION_STARTED_AT)}async getDiscussionPreviousElapsed(e){return super.read(e,a.DISCUSSION_PREVIOUS_ELAPSED)}async getDiscussionIntervalId(e){return super.read(e,a.DISCUSSION_INTERVAL_ID)}async getPowerUpVersion(e){return super.read(e,a.POWER_UP_VERSION)}setPowerUpVersion(e,t){return super.write(e,a.POWER_UP_VERSION,t)}async getPowerUpInstallationDate(e){return super.read(e,a.POWER_UP_INSTALLATION_DATE)}setPowerUpInstallationDate(e,t){return super.write(e,a.POWER_UP_INSTALLATION_DATE,t)}async getOrganisationIdHash(e){return super.read(e,a.ORGANISATION_HASH)}async setOrganisationIdHash(e,t){return super.write(e,a.ORGANISATION_HASH,t)}async getBoardIdHash(e){return super.read(e,a.BOARD_HASH)}async setBoardIdHash(e,t){return super.write(e,a.BOARD_HASH,t)}async getInitialised(e){return!!await super.read(e,a.POWER_UP_INSTALLATION_DATE)}}a.DISCUSSION_STATUS="leancoffeeDiscussionStatus",a.DISCUSSION_CARD_ID="leancoffeeDiscussionCardId",a.DISCUSSION_STARTED_AT="leancoffeeDiscussionStartedAt",a.DISCUSSION_PREVIOUS_ELAPSED="leancoffeeDiscussionPreviousElapsed",a.DISCUSSION_INTERVAL_ID="leancoffeeDiscussionIntervalId",a.POWER_UP_VERSION="powerUpVersion",a.POWER_UP_INSTALLATION_DATE="powerUpInstallationDate",a.ORGANISATION_HASH="organisationHash",a.BOARD_HASH="boardHash";var r=a;class n extends i{constructor(){super("card","shared")}getDiscussionStatus(e){return super.read(e,n.DISCUSSION_STATUS)}getDiscussionElapsed(e){return super.read(e,n.DISCUSSION_ELAPSED)}getDiscussionThumbs(e){return super.read(e,n.DISCUSSION_THUMBS)}getDiscussionButtonLabel(e){return super.read(e,n.DISCUSSION_BUTTON_LABEL)}saveDiscussionStatus(e,t,s){return super.write(e,n.DISCUSSION_STATUS,t,s)}saveDiscussionElapsed(e,t,s){return super.write(e,n.DISCUSSION_ELAPSED,t,s)}saveDiscussionThumbs(e,t){return super.write(e,n.DISCUSSION_THUMBS,t)}saveVotes(e,t){return super.write(e,n.VOTES,t)}deleteVotes(e){return super.delete(e,n.VOTES)}saveDiscussionButtonLabel(e,t){return super.write(e,n.DISCUSSION_BUTTON_LABEL,t)}deleteDiscussionThumbs(e){return super.delete(e,n.DISCUSSION_THUMBS)}}n.DISCUSSION_STATUS="leancoffeeDiscussionStatus",n.DISCUSSION_ELAPSED="leancoffeeDiscussionElapsed",n.DISCUSSION_THUMBS="leancoffeeDiscussionThumbs",n.VOTES="leancoffeeVotes",n.DISCUSSION_BUTTON_LABEL="discussionButtonLabel";var o=n;class u{constructor({w:e,config:t}){this.isRunningInProduction=()=>!0,this.w=e,this.config=t,this.boardStorage=new r,this.cardStorage=new o}}const c=e=>{const t=new URL(e);return t.protocol+t.hostname+(t.port?`:${t.port}`:"")+t.pathname};var d={beforeSend:(e,t)=>({...t,referrer:window.LeanerCoffeeAnalyticsReferrer,hostname:window.LeanerCoffeeAnalyticsHostname,url:c(t.url)}),pageview:async(e,t={})=>{e.umami?await e.umami.track((e=>({...e,...t}))):console.warn("Umami not available for pageview",t)},event:async(e,t,s)=>{e.umami?await e.umami.track(t,s):console.warn("Umami not available for event "+t,s)},getOverrides:async(e,t)=>{const s=await e.getOrganisationIdHash(t),i=await e.getBoardIdHash(t);return`referrer=${encodeURIComponent("https://"+s)}&hostname=${i}`}};const{supportedLocales:l}={hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]},h={defaultLocale:"en",supportedLocales:l,resourceUrl:"/i18n/{locale}.json"};var S;!function(e){e.UP="UP",e.DOWN="DOWN",e.MIDDLE="MIDDLE"}(S||(S={}));var g=class extends u{constructor({w:e,config:s}){super({w:e,config:s}),this.monitorDiscussion=async()=>{const e=await this.cardStorage.getDiscussionStatus(this.t),t=["ONGOING","PAUSED"].includes(e);if(!e||this.previousStatus!==e||t){switch(e){case"ENDED":this.toggleBadges(!1),this.toggleFields(".message","discussionUiMessageEnded");break;case"ONGOING":this.previousStatus!==e&&(this.toggleVoting(!1),this.toggleBadges(!0),this.toggleFields(".message",""),this.updateStatusHeader("ONGOING")),this.updateElapsed("ONGOING");break;case"PAUSED":this.previousStatus!==e&&(this.toggleFields(".message",""),this.toggleVoting(!0),this.toggleBadges(!0),this.updateStatusHeader("PAUSED"),this.updateElapsed("PAUSED")),this.updateThumbs();break;default:this.toggleBadges(!1),this.toggleVoting(!1),this.toggleFields(".message","discussionUiMessageNone")}this.previousStatus=e}},this.updateElapsed=async e=>{if("ONGOING"===e){const s=await this.boardStorage.getDiscussionStartedAt(this.t),i=await this.boardStorage.getDiscussionPreviousElapsed(this.t)||0,a=s?Date.now()-s:0,r=t()(a+i);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("paused"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionOngoing")} → ${r}`}else{const s=await this.cardStorage.getDiscussionElapsed(this.t);this.badgeElapsed.classList.add(e.toLowerCase()),this.badgeElapsed.classList.remove("ongoing"),this.badgeElapsed.textContent=`${this.t.localizeKey("discussionElapsed")} → ${t()(s)}`}},this.updateThumbs=async()=>{const e=await this.cardStorage.getDiscussionThumbs(this.t)||{},t=this.t.getContext().member,s=e[t];Object.keys(S).forEach((t=>{const i=Object.keys(e).filter((s=>e[s]===t)).length,a=this.w.document.querySelector(`.voting-${t.toLowerCase()}`);a.innerText=i.toString(),t===s?a.classList.add("own"):a.classList.remove("own")}))},this.handleThumbs=async e=>{const t=await this.cardStorage.getDiscussionThumbs(this.t)||{},s=this.t.getContext().member;return t[s]===e?(delete t[s],await d.event(this.w,"keepDiscussingVoted",{outcome:"removed",choice:e})):(t[s]=e,await d.event(this.w,"keepDiscussingVoted",{outcome:"added",choice:e})),this.cardStorage.saveDiscussionThumbs(this.t,t)},this.toggleBadges=e=>{this.badges.style.display=e?"grid":"none"},this.toggleVoting=e=>{this.voting.forEach((t=>{t.style.visibility=e?"visible":"hidden"}))},this.updateStatusHeader=e=>{"PAUSED"===e?this.toggleFields(".badge-header-text","discussionUiWhatNext"):this.toggleFields(".badge-header-text","discussionUiStatus")},this.toggleFields=(e,t)=>{this.w.document.querySelectorAll(e).forEach((e=>{const s=e.dataset.i18nId===t;e.style.display=s?"block":"none"}))},this.t=e.TrelloPowerUp.iframe({localization:h,helpfulStacks:!this.isRunningInProduction()}),this.badges=this.w.document.querySelector(".badges"),this.badgeElapsed=this.w.document.querySelector(".badge-elapsed"),this.badgeHeaderStatus=this.w.document.querySelector('[data-i18n-id="discussionUiStatus"]'),this.badgeHeaderWhatNext=this.w.document.querySelector('[data-i18n-id="discussionUiWhatNext"]'),this.messageNone=this.w.document.querySelector('[data-i18n-id="discussionUiMessageNone"]'),this.messageEnded=this.w.document.querySelector('[data-i18n-id="discussionUiMessageEnded"]'),this.voting=this.w.document.querySelectorAll(".voting")}init(){this.w.document.querySelector(".voting-up").addEventListener("click",(()=>this.handleThumbs("UP"))),this.w.document.querySelector(".voting-middle").addEventListener("click",(()=>this.handleThumbs("MIDDLE"))),this.w.document.querySelector(".voting-down").addEventListener("click",(()=>this.handleThumbs("DOWN"))),this.t.render((()=>{this.t.localizeNode(document.body),this.w.setTimeout((()=>this.t.sizeTo.call(this.t,"body")),100),this.monitorDiscussion(),this.w.clearInterval(this.intervalId),this.intervalId=this.w.setInterval(this.monitorDiscussion,1e3)}))}};new g({w:window,config:{production:{hostname:"https://leaner-coffee.tatablack.net",defaultDuration:3e5,supportedLocales:["en","it"]}}}).init()}()}();
//# sourceMappingURL=discussion-ui.37ed4f101f575d618862.js.map