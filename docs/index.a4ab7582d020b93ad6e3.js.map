{"version":3,"file":"index.a4ab7582d020b93ad6e3.js","mappings":"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","sources":["webpack://leancoffee-powerup/../node_modules/.pnpm/format-duration@3.0.2/node_modules/format-duration/format-duration.js","webpack://leancoffee-powerup/webpack/bootstrap","webpack://leancoffee-powerup/webpack/runtime/compat get default export","webpack://leancoffee-powerup/webpack/runtime/define property getters","webpack://leancoffee-powerup/webpack/runtime/hasOwnProperty shorthand","webpack://leancoffee-powerup/./src/utils/Errors.ts","webpack://leancoffee-powerup/./src/utils/Scope.ts","webpack://leancoffee-powerup/./src/storage/Storage.ts","webpack://leancoffee-powerup/./src/storage/BoardStorage.ts","webpack://leancoffee-powerup/./src/storage/CardStorage.ts","webpack://leancoffee-powerup/./src/utils/Analytics.ts","webpack://leancoffee-powerup/./src/utils/Duration.ts","webpack://leancoffee-powerup/./src/utils/I18nConfig.ts","webpack://leancoffee-powerup/./src/CapabilityHandlers.ts","webpack://leancoffee-powerup/./src/storage/MemberStorage.ts","webpack://leancoffee-powerup/./src/LeanCoffeeBase.ts","webpack://leancoffee-powerup/./src/badges/ElapsedCardBadge.ts","webpack://leancoffee-powerup/./src/badges/ElapsedCardDetailBadge.ts","webpack://leancoffee-powerup/./src/badges/VotingCardBadge.ts","webpack://leancoffee-powerup/./src/badges/VotingCardDetailBadge.ts","webpack://leancoffee-powerup/./src/utils/Notifications.ts","webpack://leancoffee-powerup/./src/utils/Discussion.ts","webpack://leancoffee-powerup/./src/utils/Hashing.ts","webpack://leancoffee-powerup/../node_modules/.pnpm/semver-parser@4.1.8/node_modules/semver-parser/modules/common.js","webpack://leancoffee-powerup/../node_modules/.pnpm/semver-parser@4.1.8/node_modules/semver-parser/modules/semver.js","webpack://leancoffee-powerup/./src/utils/VersionChecker.ts","webpack://leancoffee-powerup/./src/utils/Voting.ts","webpack://leancoffee-powerup/./src/LeanCoffeePowerUp.ts","webpack://leancoffee-powerup/./src/index.ts"],"sourcesContent":["// adapted from https://github.com/sindresorhus/parse-ms.\n// moved to internal function because parse-ms is now pure ESM.\nfunction parseMs (ms) {\n  if (typeof ms !== 'number') {\n    throw new TypeError('Expected a number')\n  }\n\n  return {\n    days: Math.trunc(ms / 86400000),\n    hours: Math.trunc(ms / 3600000) % 24,\n    minutes: Math.trunc(ms / 60000) % 60,\n    seconds: Math.trunc(ms / 1000) % 60,\n    ms: Math.trunc(ms) % 1000\n  }\n}\n\n// adapted from https://github.com/rafaelrinaldi/add-zero.\n// moved to internal function b/c addZero is unmaintained (7+ years).\n// stripped out negative sign logic since we're already doing it elsewhere.\nfunction addZero (value, digits) {\n  digits = digits || 2\n\n  let str = value.toString()\n  let size = 0\n\n  size = digits - str.length + 1\n  str = new Array(size).join('0').concat(str)\n\n  return str\n}\n\nfunction getSign (duration, showMs) {\n  if (showMs) return duration < 0 ? '-' : ''\n  return duration <= -1000 ? '-' : ''\n}\n\n/**\n * Convert a number in milliseconds to a standard duration string.\n * @param {number} ms - duration in milliseconds\n * @param {object} options - formatDuration options object\n * @param {boolean} [options.leading=false] - add leading zero\n * @param {boolean} [options.milliseconds=false] - add milliseconds\n * @returns string - formatted duration string\n */\nfunction formatDuration (ms, options) {\n  const leading = options && options.leading\n  const showMs = options && options.ms\n  const unsignedMs = ms < 0 ? -ms : ms\n  const sign = getSign(ms, showMs)\n  const t = parseMs(unsignedMs)\n  const seconds = addZero(t.seconds)\n  let output = ''\n\n  if (t.days && !output) output = sign + t.days + ':' + addZero(t.hours) + ':' + addZero(t.minutes) + ':' + seconds\n  if (t.hours && !output) output = sign + (leading ? addZero(t.hours) : t.hours) + ':' + addZero(t.minutes) + ':' + seconds\n  if (!output) output = sign + (leading ? addZero(t.minutes) : t.minutes) + ':' + seconds\n\n  if (showMs) output += '.' + addZero(t.ms, 3)\n  return output\n}\n\nmodule.exports = formatDuration\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","import BoardStorage from \"../storage/BoardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\nconst getTagsForReporting = async (\n  boardStorage: BoardStorage,\n  t: Trello.PowerUp.HostHandlers,\n): Promise<string> => {\n  const organisationIdHash = await boardStorage.read<string>(\n    t,\n    BoardStorage.ORGANISATION_HASH,\n  );\n  const boardIdHash = await boardStorage.read<string>(\n    t,\n    BoardStorage.BOARD_HASH,\n  );\n  return `organisationIdHash=${organisationIdHash}&boardIdHash=${boardIdHash}`;\n};\n\nconst isRunningInProduction = (): boolean =>\n  (process.env.NODE_ENV as Environment) === \"production\";\n\nconst ErrorReporter = (\n  target: any,\n  methodName: string,\n  descriptor: PropertyDescriptor,\n) => {\n  const originalMethod = descriptor.value;\n  const isAsync = originalMethod.constructor.name === \"AsyncFunction\";\n  const warningMessage = `Leaner Coffee Power-Up: error in ${methodName} (reported)`;\n\n  if (isAsync) {\n    descriptor.value = async function (...args: any[]) {\n      try {\n        return await originalMethod.apply(this, args);\n      } catch (error) {\n        console.warn(warningMessage);\n        window.Sentry.captureException(error);\n      }\n    };\n  } else {\n    descriptor.value = function (...args: any[]) {\n      try {\n        return originalMethod.apply(this, args);\n      } catch (error) {\n        console.warn(warningMessage);\n        window.Sentry.captureException(error);\n      }\n    };\n  }\n\n  return descriptor;\n};\n\nfunction ErrorReporterInjector<T extends { new (...args: any[]): object }>(\n  constructor: T,\n) {\n  // Get all prototype methods\n  const prototype = constructor.prototype;\n  const methodNames = Object.getOwnPropertyNames(prototype).filter(\n    (name) => typeof prototype[name] === \"function\" && name !== \"constructor\", // Skip constructor\n  );\n\n  // Apply the ErrorReporter decorator to each method\n  methodNames.forEach((methodName) => {\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, methodName);\n    if (descriptor && typeof descriptor.value === \"function\") {\n      const decoratedDescriptor = ErrorReporter(\n        prototype,\n        methodName,\n        descriptor,\n      );\n\n      // console.log(\n      //   `Decorating ${constructor.name}::${methodName} with ErrorReporter`,\n      // );\n      Object.defineProperty(prototype, methodName, decoratedDescriptor);\n    }\n  });\n\n  return constructor;\n}\n\nexport {\n  getTagsForReporting,\n  isRunningInProduction,\n  ErrorReporter,\n  ErrorReporterInjector,\n};\n","const bindAll = (classInstance: any) => {\n  const p = classInstance.constructor.prototype;\n  const methodNames = Object.getOwnPropertyNames(p).filter(\n    (name) => typeof p[name] === \"function\" && name !== \"constructor\", // Skip constructor\n  );\n\n  methodNames.forEach(\n    (methodName) => (p[methodName] = p[methodName].bind(classInstance)),\n  );\n};\n\nexport { bindAll };\n","import { Trello } from \"../types/TrelloPowerUp\";\nimport { ErrorReporterInjector } from \"../utils/Errors\";\nimport { bindAll } from \"../utils/Scope\";\n\n@ErrorReporterInjector\nclass Storage {\n  scope: Trello.PowerUp.Scope;\n  visibility: Trello.PowerUp.Visibility;\n\n  constructor(\n    scope: Trello.PowerUp.Scope = \"member\",\n    visibility: Trello.PowerUp.Visibility = \"private\",\n  ) {\n    Object.assign(this, { scope, visibility });\n    bindAll(this);\n  }\n\n  canWrite(t: Trello.PowerUp.HostHandlers): boolean {\n    return this.scope === \"member\" || t.memberCanWriteToModel(this.scope);\n  }\n\n  static async getMemberType(\n    t: Trello.PowerUp.AnonymousHostHandlers,\n  ): Promise<string> {\n    const board = await t.board(\"memberships\");\n    const currentMember = await t.member(\"id\");\n    const myMembership = board.memberships.find(\n      (m) => m.idMember === currentMember.id,\n    );\n    return myMembership ? myMembership.memberType : \"unknown\";\n  }\n\n  read<T>(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    key: string,\n    cardId?: string,\n  ): PromiseLike<T> {\n    return t.get(cardId ?? this.scope, this.visibility, key);\n  }\n\n  async write(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    key: string,\n    value: any,\n    cardId?: string,\n  ): Promise<void> {\n    if (!(\"memberCanWriteToModel\" in t)) {\n      window.Sentry.addBreadcrumb({\n        category: \"database\",\n        message: `Unknown permissions when trying to save \"${key}\" to the \"${this.scope}\" ${this.visibility} scope\"`,\n        level: \"warning\",\n      });\n    }\n\n    if (!(\"memberCanWriteToModel\" in t) || this.canWrite(t)) {\n      await t.set(cardId ?? this.scope, this.visibility, key, value);\n    } else {\n      window.Sentry.captureException(new Error(\"Error while editing scope\"), {\n        contexts: {\n          WriteOperation: {\n            scope: this.scope,\n            visibility: this.visibility,\n            key: key,\n            hasCardId: !!cardId,\n            memberType: await Storage.getMemberType(t),\n          },\n        },\n      });\n    }\n  }\n\n  async writeMultiple(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    entries: {\n      [key: string]: any;\n    },\n    cardId?: string,\n  ): Promise<void> {\n    if (!(\"memberCanWriteToModel\" in t)) {\n      window.Sentry.addBreadcrumb({\n        category: \"database\",\n        message: `Unknown permissions when trying to save \"${Object.keys(entries).join(\", \")}\" to the \"${this.scope}\" ${this.visibility} scope`,\n        level: \"warning\",\n      });\n    }\n\n    if (!(\"memberCanWriteToModel\" in t) || this.canWrite(t)) {\n      await t.set(cardId ?? this.scope, this.visibility, entries);\n    } else {\n      window.Sentry.captureException(new Error(\"Error while editing scope\"), {\n        contexts: {\n          WriteOperation: {\n            scope: this.scope,\n            visibility: this.visibility,\n            key: Object.keys(entries),\n            hasCardId: !!cardId,\n            memberType: await Storage.getMemberType(t),\n          },\n        },\n      });\n    }\n  }\n\n  async delete(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    key: string,\n    cardId?: string,\n  ): Promise<void> {\n    if (!(\"memberCanWriteToModel\" in t)) {\n      window.Sentry.addBreadcrumb({\n        category: \"database\",\n        message: `Unknown permissions when trying to save \"${key}\" to the \"${this.scope}\" ${this.visibility} scope\"`,\n        level: \"warning\",\n      });\n    }\n\n    if (!(\"memberCanWriteToModel\" in t) || this.canWrite(t)) {\n      return t.remove(cardId ?? this.scope, this.visibility, key);\n    } else {\n      window.Sentry.captureException(new Error(\"Error while editing scope\"), {\n        contexts: {\n          DeleteOperation: {\n            scope: this.scope,\n            visibility: this.visibility,\n            key: key,\n            hasCardId: !!cardId,\n            memberType: await Storage.getMemberType(t),\n          },\n        },\n      });\n    }\n  }\n\n  async deleteMultiple(\n    t: Trello.PowerUp.HostHandlers | Trello.PowerUp.AnonymousHostHandlers,\n    entries: string[],\n    cardId?: string,\n  ): Promise<void> {\n    if (!(\"memberCanWriteToModel\" in t)) {\n      window.Sentry.addBreadcrumb({\n        category: \"database\",\n        message: `Unknown permissions when trying to save \"${Object.keys(entries).join(\", \")}\" to the \"${this.scope}\" ${this.visibility} scope`,\n        level: \"warning\",\n      });\n    }\n\n    if (!(\"memberCanWriteToModel\" in t) || this.canWrite(t)) {\n      return t.remove(cardId ?? this.scope, this.visibility, entries);\n    } else {\n      window.Sentry.captureException(new Error(\"Error while editing scope\"), {\n        contexts: {\n          DeleteOperation: {\n            scope: this.scope,\n            visibility: this.visibility,\n            key: Object.keys(entries),\n            hasCardId: !!cardId,\n            memberType: await Storage.getMemberType(t),\n          },\n        },\n      });\n    }\n  }\n}\n\nexport default Storage;\n","import Storage from \"./Storage\";\n\nclass BoardStorage extends Storage {\n  static DISCUSSION_STATUS = \"leancoffeeDiscussionStatus\";\n  static DISCUSSION_CARD_ID = \"leancoffeeDiscussionCardId\";\n  static DISCUSSION_STARTED_AT = \"leancoffeeDiscussionStartedAt\";\n  static DISCUSSION_PREVIOUS_ELAPSED = \"leancoffeeDiscussionPreviousElapsed\";\n  static DISCUSSION_INTERVAL_ID = \"leancoffeeDiscussionIntervalId\";\n  static POWER_UP_INSTALLATION_DATE = \"powerUpInstallationDate\";\n  static ORGANISATION_HASH = \"organisationHash\";\n  static BOARD_HASH = \"boardHash\";\n\n  constructor() {\n    super(\"board\", \"shared\");\n  }\n}\n\nexport default BoardStorage;\n","import Storage from \"./Storage\";\n\nclass CardStorage extends Storage {\n  static DISCUSSION_STATUS = \"leancoffeeDiscussionStatus\";\n  static DISCUSSION_ELAPSED = \"leancoffeeDiscussionElapsed\";\n  static DISCUSSION_THUMBS = \"leancoffeeDiscussionThumbs\";\n  static VOTES = \"leancoffeeVotes\";\n  static DISCUSSION_BUTTON_LABEL = \"discussionButtonLabel\";\n\n  constructor() {\n    super(\"card\", \"shared\");\n  }\n}\n\nexport default CardStorage;\n","import BoardStorage from \"../storage/BoardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\nimport CustomPayload = umami.CustomPayload;\n\nconst sanitiseUrl = (urlString: string): string => {\n  const url = new URL(urlString);\n  return (\n    url.protocol +\n    url.hostname +\n    (url.port ? `:${url.port}` : \"\") +\n    url.pathname\n  );\n};\n\nconst beforeSend = (event: string, payload: CustomPayload): CustomPayload => {\n  return {\n    ...payload,\n    ...{\n      referrer: window.LeanerCoffeeAnalyticsReferrer,\n      hostname: window.LeanerCoffeeAnalyticsHostname,\n    },\n    url: sanitiseUrl(payload.url),\n  };\n};\n\nconst pageview = async (window: Window, eventData: umami.EventData = {}) => {\n  if (window.umami) {\n    await window.umami.track((props: any) => {\n      return { ...props, ...eventData };\n    });\n  } else {\n    console.warn(\"Umami not available for pageview\", eventData);\n  }\n};\n\nconst event = async (\n  window: Window,\n  eventName: string,\n  eventData?: umami.EventData,\n) => {\n  if (window.umami) {\n    await window.umami.track(eventName, eventData);\n  } else {\n    console.warn(\"Umami not available for event \" + eventName, eventData);\n  }\n};\n\nconst getOverrides = async (\n  boardStorage: BoardStorage,\n  t: Trello.PowerUp.HostHandlers,\n): Promise<string> => {\n  const organisationIdHash = await boardStorage.read<string>(\n    t,\n    BoardStorage.ORGANISATION_HASH,\n  );\n  const boardIdHash = await boardStorage.read<string>(\n    t,\n    BoardStorage.BOARD_HASH,\n  );\n  const referrer = encodeURIComponent(\"https://\" + organisationIdHash);\n  return `referrer=${referrer}&hostname=${boardIdHash}`;\n};\n\nconst Analytics = {\n  beforeSend,\n  pageview,\n  event,\n  getOverrides,\n};\n\nexport default Analytics;\n","const INTERVALS = {\n  ONE_DAY: 24 * 60 * 60 * 1000,\n  ONE_WEEK: 7 * 24 * 60 * 60 * 1000,\n  ONE_MONTH: 30 * 24 * 60 * 60 * 1000,\n  SIX_MONTHS: 6 * 30 * 24 * 60 * 60 * 1000,\n  ONE_YEAR: 365 * 24 * 60 * 60 * 1000,\n  TWO_YEARS: 2 * 365 * 24 * 60 * 60 * 1000,\n  FIVE_YEARS: 5 * 365 * 24 * 60 * 60 * 1000,\n};\n\nfunction classifyDuration(duration: number): string {\n  switch (true) {\n    case duration < INTERVALS.ONE_DAY:\n      return \"Less than a day\";\n\n    case duration >= INTERVALS.ONE_DAY && duration < INTERVALS.ONE_WEEK:\n      return \"Between a day and a week\";\n\n    case duration >= INTERVALS.ONE_WEEK && duration < INTERVALS.ONE_MONTH:\n      return \"Between a week and a month\";\n\n    case duration >= INTERVALS.ONE_MONTH && duration < INTERVALS.SIX_MONTHS:\n      return \"Between a month and six months\";\n\n    case duration >= INTERVALS.SIX_MONTHS && duration < INTERVALS.ONE_YEAR:\n      return \"Between six months and a year\";\n\n    case duration >= INTERVALS.ONE_YEAR && duration < INTERVALS.TWO_YEARS:\n      return \"Between one and two years\";\n\n    case duration >= INTERVALS.TWO_YEARS && duration < INTERVALS.FIVE_YEARS:\n      return \"Between two and five years\";\n\n    case duration >= INTERVALS.FIVE_YEARS:\n      return \"More than five years\";\n\n    default:\n      return \"Invalid duration\";\n  }\n}\n\nexport default classifyDuration;\n","import { Trello } from \"../types/TrelloPowerUp\";\n\nconst config: Config = process.env.CONFIG as unknown as Config;\nconst { supportedLocales } = config[process.env.NODE_ENV as Environment];\n\nexport const I18nConfig: Trello.PowerUp.Localization = {\n  defaultLocale: \"en\",\n  supportedLocales,\n  resourceUrl: \"/i18n/{locale}.json\",\n};\n","import LeanCoffeePowerUp from \"./LeanCoffeePowerUp\";\nimport BoardStorage from \"./storage/BoardStorage\";\nimport CardStorage from \"./storage/CardStorage\";\nimport { Trello } from \"./types/TrelloPowerUp\";\nimport Analytics from \"./utils/Analytics\";\nimport classifyDuration from \"./utils/Duration\";\nimport { ErrorReporterInjector } from \"./utils/Errors\";\nimport { I18nConfig } from \"./utils/I18nConfig\";\nimport { bindAll } from \"./utils/Scope\";\n\n@ErrorReporterInjector\nclass CapabilityHandlers {\n  powerUp: LeanCoffeePowerUp;\n\n  constructor(powerUp: LeanCoffeePowerUp) {\n    this.powerUp = powerUp;\n    bindAll(this);\n  }\n\n  async boardButtonsHandler(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.BoardButtonCallback[]> {\n    // We don't want to show the board button for the release notes\n    // if there is a new patch version: only for minor and major updates.\n    if (!(await this.powerUp.versionChecker.isThereANewMinorOrMajor(t))) {\n      return [];\n    }\n\n    return [\n      {\n        icon: {\n          dark: `${this.powerUp.baseUrl}/assets/moka_white.svg`,\n          light: `${this.powerUp.baseUrl}/assets/moka.svg`,\n        },\n        text: t.localizeKey(\"boardButtonLabel\"),\n        callback: this.powerUp.versionChecker.showMenu,\n      },\n    ];\n  }\n\n  async cardBackSection(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardBackSection> {\n    const discussionStatus =\n      await this.powerUp.discussion.cardStorage.read<DiscussionStatus>(\n        t,\n        CardStorage.DISCUSSION_STATUS,\n      );\n    if (discussionStatus === undefined) {\n      return null;\n    }\n\n    return {\n      title: t.localizeKey(\"discussion\"),\n      icon: `${this.powerUp.baseUrl}/assets/powerup/timer.svg`,\n      content: {\n        type: \"iframe\",\n        url: t.signUrl(\n          `${this.powerUp.baseUrl}/discussion-ui.html?${await Analytics.getOverrides(this.powerUp.boardStorage, t)}`,\n        ),\n      },\n    };\n  }\n\n  async cardBadges(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardBadge[]> {\n    const badges = [\n      await this.powerUp.elapsedCardBadge.render(t),\n      await this.powerUp.votingCardBadge.render(t),\n    ];\n\n    return badges.filter((badge) => badge);\n  }\n\n  async cardButtons(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardButton[]> {\n    return [\n      {\n        icon: `${this.powerUp.baseUrl}/assets/powerup/timer.svg`,\n        text: await this.powerUp.getButtonLabel(t),\n        callback: this.powerUp.handleDiscussion,\n      },\n      {\n        icon: `${this.powerUp.baseUrl}/assets/powerup/heart.svg`,\n        text: t.localizeKey(\"vote\", {\n          symbol: (await this.powerUp.voting.hasCurrentMemberVoted(t))\n            ? \"☑\"\n            : \"☐\",\n        }),\n        callback: this.powerUp.handleVoting,\n      },\n    ];\n  }\n\n  async cardDetailBadges(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardDetailBadge[]> {\n    const badges = [\n      await this.powerUp.elapsedCardDetailBadge.render(t),\n      await this.powerUp.votingCardDetailBadge.render(t),\n    ];\n\n    return badges.filter((badge) => badge);\n  }\n  async listActions(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.ListAction[]> {\n    return Promise.resolve([\n      {\n        text: t.localizeKey(\"clearVotesFromList\"),\n        callback: async (t2): Promise<void> => {\n          const result = await t2.list(\"cards\");\n          result.cards.forEach(({ id }) => {\n            this.powerUp.cardStorage.deleteMultiple(\n              t2,\n              [CardStorage.VOTES],\n              id,\n            );\n          });\n          await Analytics.event(window, \"listVotesCleared\");\n        },\n      },\n    ]);\n  }\n\n  async listSorters(\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.ListSorter[]> {\n    return Promise.resolve([\n      {\n        text: t.localizeKey(\"sortByVote\"),\n        callback: async (t2, opts): Promise<{ sortedIds: string[] }> => {\n          const votingData = await Promise.all(\n            opts.cards.map(\n              async (\n                card,\n              ): Promise<{ leanCoffeeVotes: number; id: string }> => {\n                const leanCoffeeVotes =\n                  await this.powerUp.voting.countVotesByCard(t2, card.id);\n                return { leanCoffeeVotes, id: card.id };\n              },\n            ),\n          );\n\n          const sortedCards = votingData.sort((cardA, cardB) => {\n            if (cardA.leanCoffeeVotes < cardB.leanCoffeeVotes) {\n              return 1;\n            }\n            if (cardB.leanCoffeeVotes < cardA.leanCoffeeVotes) {\n              return -1;\n            }\n            return 0;\n          });\n\n          await Analytics.event(window, \"listVotesSorted\");\n\n          return {\n            sortedIds: sortedCards.map((card) => card.id),\n          };\n        },\n      },\n    ]);\n  }\n\n  async onEnable(t: Trello.PowerUp.IFrame): Promise<void> {\n    // There can be a race condition between the power-up starting\n    // and the on-enable event being triggered.\n    await navigator.locks.request(\n      \"powerup_init\",\n      { ifAvailable: true },\n      async (lock) => {\n        const isInitialised = !!(await this.powerUp.boardStorage.read<string>(\n          t,\n          BoardStorage.POWER_UP_INSTALLATION_DATE,\n        ));\n        // if the lock is null, it means LeanCoffeePowerup::start is taking care of initialisation\n        if (lock === null || isInitialised) {\n          return;\n        }\n\n        if (!isInitialised) {\n          await this.powerUp.handlePowerupEnabled(t);\n        }\n      },\n    );\n\n    await Analytics.event(window, \"enabled\");\n  }\n  async onDisable(t: Trello.PowerUp.IFrame): Promise<void> {\n    const installationDate = await this.powerUp.boardStorage.read<string>(\n      t,\n      BoardStorage.POWER_UP_INSTALLATION_DATE,\n    );\n\n    await Analytics.event(window, \"disabled\", {\n      installedFor: classifyDuration(Date.now() - Date.parse(installationDate)),\n    });\n  }\n\n  async showSettings(t: Trello.PowerUp.IFrame): Promise<void> {\n    return t.popup({\n      title: `Leaner Coffee ${__BUILDTIME_VERSION__}`,\n      url: `${this.powerUp.baseUrl}/settings.html?${await Analytics.getOverrides(this.powerUp.boardStorage, t)}`,\n      height: 184,\n      args: {\n        localization: I18nConfig,\n      },\n    });\n  }\n\n  getAll(): Trello.PowerUp.CapabilityHandlers {\n    return {\n      \"board-buttons\": this.boardButtonsHandler,\n      \"card-back-section\": this.cardBackSection,\n      \"card-badges\": this.cardBadges,\n      \"card-buttons\": this.cardButtons,\n      \"card-detail-badges\": this.cardDetailBadges,\n      \"list-actions\": this.listActions,\n      \"list-sorters\": this.listSorters,\n      \"on-enable\": this.onEnable,\n      \"on-disable\": this.onDisable,\n      \"show-settings\": this.showSettings,\n    };\n  }\n}\n\nexport default CapabilityHandlers;\n","import Storage from \"./Storage\";\n\nclass MemberStorage extends Storage {\n  static POWER_UP_VERSION = \"powerUpVersion\";\n\n  constructor() {\n    super(\"member\", \"private\");\n  }\n}\n\nexport default MemberStorage;\n","import BoardStorage from \"./storage/BoardStorage\";\nimport CardStorage from \"./storage/CardStorage\";\nimport MemberStorage from \"./storage/MemberStorage\";\nimport { Trello } from \"./types/TrelloPowerUp\";\nimport { ErrorReporterInjector } from \"./utils/Errors\";\nimport { bindAll } from \"./utils/Scope\";\n\nexport interface LeanCoffeeBaseParams {\n  w: Window;\n  config: Config;\n  t?: Trello.PowerUp | Trello.PowerUp.IFrame;\n}\n\n@ErrorReporterInjector\nexport class LeanCoffeeBase {\n  w: Window;\n  boardStorage: BoardStorage;\n  cardStorage: CardStorage;\n  memberStorage: MemberStorage;\n  config: Config;\n\n  constructor({ w, config }: LeanCoffeeBaseParams) {\n    this.w = w;\n    this.config = config;\n    this.boardStorage = new BoardStorage();\n    this.cardStorage = new CardStorage();\n    this.memberStorage = new MemberStorage();\n    bindAll(this);\n  }\n}\n","import formatDuration from \"format-duration\";\n\nimport { Trello } from \"../types/TrelloPowerUp\";\nimport Discussion from \"../utils/Discussion\";\nimport { ErrorReporterInjector } from \"../utils/Errors\";\nimport { bindAll } from \"../utils/Scope\";\n\n@ErrorReporterInjector\nclass ElapsedCardBadge {\n  discussion: Discussion;\n\n  constructor(discussion: Discussion) {\n    this.discussion = discussion;\n    this.render = this.render.bind(this);\n    bindAll(this);\n  }\n\n  getText = async (\n    t: Trello.PowerUp.IFrame,\n    elapsed: number,\n  ): Promise<string> => formatDuration(elapsed);\n\n  getColor = async (\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.Colors> => {\n    const isOngoing = await this.discussion.isOngoingFor(t);\n\n    if (isOngoing) {\n      return \"orange\";\n    }\n\n    return (await this.discussion.isPausedFor(t)) ? \"yellow\" : \"light-gray\";\n  };\n\n  // Unable to use class properties here because in subclasses\n  // I need to user `super`, and it wouldn't be possible. See:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super#accessing_super_in_class_field_declaration\n  async render(t: Trello.PowerUp.IFrame): Promise<Trello.PowerUp.CardBadge> {\n    const elapsed = await this.discussion.getElapsed(t);\n    if (!Number.isFinite(elapsed)) {\n      return null;\n    }\n\n    return {\n      text: await this.getText(t, elapsed),\n      color: await this.getColor(t),\n    };\n  }\n}\n\nexport default ElapsedCardBadge;\n","import ElapsedCardBadge from \"./ElapsedCardBadge\";\nimport CardStorage from \"../storage/CardStorage\";\nimport Storage from \"../storage/Storage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\nclass ElapsedCardDetailBadge extends ElapsedCardBadge {\n  render = async (\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardDetailBadge> => {\n    const discussionStatus =\n      await this.discussion.cardStorage.read<DiscussionStatus>(\n        t,\n        CardStorage.DISCUSSION_STATUS,\n      );\n    if (discussionStatus !== \"ENDED\") {\n      return null;\n    }\n\n    const badge = (await super.render(t)) as Trello.PowerUp.CardDetailBadge;\n\n    if (badge === null) {\n      window.Sentry.captureMessage(\"Inconsistent data\", {\n        contexts: {\n          CardDetailBadge: {\n            discussionStatus,\n            discussionElapsed: await this.discussion.cardStorage.read<number>(\n              t,\n              CardStorage.DISCUSSION_ELAPSED,\n            ),\n            discussionButtonLabel:\n              await this.discussion.cardStorage.read<string>(\n                t,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n              ),\n            memberType: await Storage.getMemberType(t),\n          },\n        },\n      });\n\n      return null;\n    }\n\n    badge.title = t.localizeKey(\"discussionDurationTitle\");\n    return badge;\n  };\n}\n\nexport default ElapsedCardDetailBadge;\n","import BoardStorage from \"../storage/BoardStorage\";\nimport CardStorage from \"../storage/CardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\nimport { ErrorReporterInjector } from \"../utils/Errors\";\nimport { bindAll } from \"../utils/Scope\";\nimport Voting from \"../utils/Voting\";\n\n@ErrorReporterInjector\nclass VotingCardBadge {\n  w: Window;\n  baseUrl: string;\n  voting: Voting;\n  boardStorage: BoardStorage;\n  cardStorage: CardStorage;\n\n  constructor(\n    w: Window,\n    baseUrl: string,\n    voting: Voting,\n    boardStorage: BoardStorage,\n    cardStorage: CardStorage,\n  ) {\n    this.w = w;\n    this.baseUrl = baseUrl;\n    this.voting = voting;\n    this.boardStorage = boardStorage;\n    this.cardStorage = cardStorage;\n    this.render = this.render.bind(this);\n    bindAll(this);\n  }\n\n  getVoters = async (t: Trello.PowerUp.IFrame): Promise<{ text: string }[]> => {\n    const votes: Votes = (await this.voting.getVotes(t)) || {};\n\n    return Object.values(votes).reduce(\n      (knownVoters: { text: string; avatar: string }[], vote) => {\n        if (vote.username) {\n          knownVoters.push({\n            text: `${vote.fullName} (${vote.username})`,\n            avatar: vote.avatar,\n          });\n        }\n\n        return knownVoters;\n      },\n      [],\n    );\n  };\n\n  // Unable to use class properties here because in subclasses\n  // I need to user `super`, and it wouldn't be possible. See:\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/super#accessing_super_in_class_field_declaration\n  async render(t: Trello.PowerUp.IFrame): Promise<Trello.PowerUp.CardBadge> {\n    const voters = await this.getVoters(t);\n\n    if (!voters.length) {\n      return null;\n    }\n\n    const hasVoted = await this.voting.hasCurrentMemberVoted(t);\n\n    return {\n      text: voters.length.toString(),\n      color: hasVoted ? \"blue\" : null,\n      icon: `${this.baseUrl}/assets/powerup/${hasVoted ? \"heart_white.svg\" : \"heart.svg\"}`,\n    };\n  }\n}\n\nexport default VotingCardBadge;\n","import VotingCardBadge from \"./VotingCardBadge\";\nimport CardStorage from \"../storage/CardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\nimport Analytics from \"../utils/Analytics\";\nimport { getTagsForReporting } from \"../utils/Errors\";\nimport { I18nConfig } from \"../utils/I18nConfig\";\n\nclass VotingCardDetailBadge extends VotingCardBadge {\n  clearVoters = async (t: Trello.PowerUp.IFrame) => {\n    const totalVoters = await this.getVoters(t);\n\n    await this.cardStorage.delete(t, CardStorage.VOTES);\n    await Analytics.event(this.w, \"votesCleared\", {\n      total: totalVoters.length,\n    });\n  };\n\n  showVoters = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    const items = await this.getVoters(t);\n\n    if (!items.length) {\n      return;\n    }\n\n    await t.popup({\n      title: t.localizeKey(\"voters\"),\n      url: `./voters.html?${await Analytics.getOverrides(this.boardStorage, t)}&${await getTagsForReporting(this.boardStorage, t)}`,\n      args: {\n        items,\n        localization: I18nConfig,\n      },\n      callback: this.clearVoters,\n    });\n  };\n\n  render = async (\n    t: Trello.PowerUp.IFrame,\n  ): Promise<Trello.PowerUp.CardDetailBadge> => {\n    const commonData = (await super.render(\n      t,\n    )) as Trello.PowerUp.CardDetailBadge;\n\n    if (commonData) {\n      commonData.title = t.localizeKey(\"voters\");\n      delete commonData.icon;\n      commonData.callback = this.showVoters;\n    }\n\n    return commonData;\n  };\n}\n\nexport default VotingCardDetailBadge;\n","import { ErrorReporterInjector } from \"./Errors\";\nimport { bindAll } from \"./Scope\";\n\nexport type NotificationType = {\n  [key in \"audio\" | \"text\"]: string;\n};\n\n@ErrorReporterInjector\nclass Notifications {\n  w: Window;\n  baseUrl: string;\n  audioContext: AudioContext;\n\n  constructor(window: Window, baseUrl: string) {\n    this.w = window;\n    this.baseUrl = baseUrl;\n    bindAll(this);\n  }\n\n  async load(url: string): Promise<AudioBufferSourceNode> {\n    const remoteAudioFile = await fetch(url);\n    const audioData = await remoteAudioFile.arrayBuffer();\n    const audioBuffer = await this.audioContext.decodeAudioData(audioData);\n    const sourceNode = this.audioContext.createBufferSource();\n    sourceNode.buffer = audioBuffer;\n    sourceNode.connect(this.audioContext.destination);\n    return sourceNode;\n  }\n\n  async play(type: NotificationType): Promise<void> {\n    this.audioContext =\n      this.audioContext || new (AudioContext || this.w.webkitAudioContext)();\n    const audio = await this.load(`${this.baseUrl}/${type.audio}`);\n    audio.start();\n  }\n\n  open(type: NotificationType, cardName: string): void {\n    new Notification(cardName, {\n      body: type.text,\n      icon: `${this.baseUrl}/assets/timer.png`,\n    });\n  }\n\n  show(type: NotificationType, cardName: string): void {\n    if (!(\"Notification\" in this.w) || Notification.permission === \"denied\") {\n      return;\n    }\n\n    if (Notification.permission === \"granted\") {\n      this.open(type, cardName);\n    } else {\n      Notification.requestPermission((permission) => {\n        if (permission === \"granted\") {\n          this.open(type, cardName);\n        }\n      });\n    }\n  }\n}\n\nexport default Notifications;\n","import Analytics from \"./Analytics\";\nimport { ErrorReporterInjector } from \"./Errors\";\nimport Notifications, { NotificationType } from \"./Notifications\";\nimport { bindAll } from \"./Scope\";\nimport BoardStorage from \"../storage/BoardStorage\";\nimport CardStorage from \"../storage/CardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\n@ErrorReporterInjector\nclass Discussion {\n  w: Window;\n  p: Trello.PowerUp.AnonymousHostHandlers;\n  baseUrl: string;\n  maxDiscussionDuration: number;\n  notifications: Notifications;\n  boardStorage: BoardStorage;\n  cardStorage: CardStorage;\n\n  constructor(window: Window, baseUrl: string, maxDiscussionDuration: number) {\n    this.w = window;\n    this.baseUrl = baseUrl;\n    this.notifications = new Notifications(this.w, this.baseUrl);\n    this.maxDiscussionDuration = maxDiscussionDuration;\n    this.boardStorage = new BoardStorage();\n    this.cardStorage = new CardStorage();\n    bindAll(this);\n  }\n\n  init = (p: Trello.PowerUp.AnonymousHostHandlers): void => {\n    this.p = p;\n  };\n\n  getElapsedNotification = (): NotificationType => ({\n    audio: \"assets/looking_down.mp3\",\n    text: this.p.localizeKey(\"elapsedNotification\"),\n  });\n\n  isOngoingOrPausedForAnotherCard = async (\n    t: Trello.PowerUp.IFrame,\n  ): Promise<boolean> => {\n    const boardStatus = await this.boardStorage.read<DiscussionStatus>(\n      t,\n      BoardStorage.DISCUSSION_STATUS,\n    );\n    const cardId = await this.boardStorage.read<string>(\n      t,\n      BoardStorage.DISCUSSION_CARD_ID,\n    );\n\n    return (\n      [\"ONGOING\", \"PAUSED\"].includes(boardStatus) &&\n      cardId !== t.getContext().card\n    );\n  };\n\n  hasEverBeenDiscussed = async (t: Trello.PowerUp.IFrame): Promise<boolean> => {\n    const cardStatus = await this.cardStorage.read<DiscussionStatus>(\n      t,\n      CardStorage.DISCUSSION_STATUS,\n    );\n    return cardStatus !== undefined;\n  };\n\n  hasNotBeenArchived = async (\n    t: Trello.PowerUp.IFrame,\n    cardId: string,\n  ): Promise<boolean> => {\n    const allCards = await t.cards(\"id\", \"name\");\n    return !!allCards.find((card) => card.id === cardId);\n  };\n\n  isOngoingFor = async (t: Trello.PowerUp.IFrame): Promise<boolean> => {\n    const cardStatus = await this.cardStorage.read<DiscussionStatus>(\n      t,\n      CardStorage.DISCUSSION_STATUS,\n    );\n    return cardStatus === \"ONGOING\";\n  };\n\n  isPausedFor = async (t: Trello.PowerUp.IFrame): Promise<boolean> => {\n    const cardStatus = await this.cardStorage.read<DiscussionStatus>(\n      t,\n      CardStorage.DISCUSSION_STATUS,\n    );\n    return cardStatus === \"PAUSED\";\n  };\n\n  getElapsed = (t: Trello.PowerUp.IFrame): PromiseLike<number> =>\n    this.cardStorage.read<number>(t, CardStorage.DISCUSSION_ELAPSED);\n\n  updateElapsed = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    const startedAt = await this.boardStorage.read<number>(\n      t,\n      BoardStorage.DISCUSSION_STARTED_AT,\n    );\n    const elapsed = Date.now() - startedAt;\n\n    await this.saveElapsed(t);\n\n    if (elapsed > this.maxDiscussionDuration) {\n      await this.pause(t, true);\n      await Analytics.event(this.w, \"discussionStatusChanged\", {\n        newStatus: \"ended\",\n      });\n    }\n  };\n\n  saveElapsed = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    const cardId = await this.boardStorage.read<string>(\n      t,\n      BoardStorage.DISCUSSION_CARD_ID,\n    );\n    const startedAt = await this.boardStorage.read<number>(\n      t,\n      BoardStorage.DISCUSSION_STARTED_AT,\n    );\n    const previousElapsed =\n      (await this.boardStorage.read<number>(\n        t,\n        BoardStorage.DISCUSSION_PREVIOUS_ELAPSED,\n      )) || 0;\n    const elapsed = startedAt ? Date.now() - startedAt : 0;\n\n    await this.cardStorage.write(\n      t,\n      CardStorage.DISCUSSION_ELAPSED,\n      elapsed + previousElapsed,\n      cardId,\n    );\n  };\n\n  start = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    await this.boardStorage.writeMultiple(t, {\n      [BoardStorage.DISCUSSION_STATUS]: \"ONGOING\",\n      [BoardStorage.DISCUSSION_CARD_ID]: t.getContext().card,\n      [BoardStorage.DISCUSSION_STARTED_AT]: Date.now(),\n      [BoardStorage.DISCUSSION_PREVIOUS_ELAPSED]: await this.getElapsed(t),\n      [BoardStorage.DISCUSSION_INTERVAL_ID]: setInterval(\n        this.updateElapsed,\n        5000,\n        t,\n      ),\n    });\n\n    await this.cardStorage.write(t, CardStorage.DISCUSSION_STATUS, \"ONGOING\");\n    await this.cardStorage.delete(t, CardStorage.DISCUSSION_THUMBS);\n  };\n\n  pause = async (t: Trello.PowerUp.IFrame, notify = false): Promise<void> => {\n    const intervalId = await this.boardStorage.read<DiscussionIntervalId>(\n      t,\n      BoardStorage.DISCUSSION_INTERVAL_ID,\n    );\n    const cardId = await this.boardStorage.read<string>(\n      t,\n      BoardStorage.DISCUSSION_CARD_ID,\n    );\n    const cardName = (await t.cards(\"id\", \"name\")).find(\n      (card) => card.id === cardId,\n    ).name;\n\n    clearInterval(intervalId);\n\n    await this.cardStorage.write(t, CardStorage.DISCUSSION_STATUS, \"PAUSED\");\n    await this.saveElapsed(t);\n    await this.boardStorage.writeMultiple(t, {\n      [BoardStorage.DISCUSSION_STATUS]: \"PAUSED\",\n      [BoardStorage.DISCUSSION_STARTED_AT]: null,\n      [BoardStorage.DISCUSSION_PREVIOUS_ELAPSED]: await this.getElapsed(t),\n      [BoardStorage.DISCUSSION_INTERVAL_ID]: null,\n    });\n\n    if (notify) {\n      const elapsedNotification = this.getElapsedNotification();\n      await this.notifications.play(elapsedNotification);\n      this.notifications.show(elapsedNotification, cardName);\n    }\n  };\n\n  end = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    const intervalId = await this.boardStorage.read<DiscussionIntervalId>(\n      t,\n      BoardStorage.DISCUSSION_INTERVAL_ID,\n    );\n    const cardId = await this.boardStorage.read<string>(\n      t,\n      BoardStorage.DISCUSSION_CARD_ID,\n    );\n    clearInterval(intervalId);\n\n    await this.cardStorage.write(\n      t,\n      CardStorage.DISCUSSION_STATUS,\n      \"ENDED\",\n      cardId,\n    );\n    await this.saveElapsed(t);\n    await this.cardStorage.deleteMultiple(\n      t,\n      [CardStorage.DISCUSSION_THUMBS],\n      cardId,\n    );\n    await this.boardStorage.deleteMultiple(t, [\n      BoardStorage.DISCUSSION_STATUS,\n      BoardStorage.DISCUSSION_CARD_ID,\n      BoardStorage.DISCUSSION_STARTED_AT,\n      BoardStorage.DISCUSSION_PREVIOUS_ELAPSED,\n      BoardStorage.DISCUSSION_INTERVAL_ID,\n    ]);\n  };\n\n  reset = async (t: Trello.PowerUp.IFrame): Promise<void> => {\n    if (await this.hasEverBeenDiscussed(t)) {\n      await this.cardStorage.deleteMultiple(\n        t,\n        [\n          CardStorage.DISCUSSION_STATUS,\n          CardStorage.DISCUSSION_ELAPSED,\n          CardStorage.DISCUSSION_THUMBS,\n        ],\n        t.getContext().card,\n      );\n    }\n  };\n}\n\nexport default Discussion;\n","// https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest\nexport async function digestMessage(message: string) {\n  const msgUint8 = new TextEncoder().encode(message); // encode as (utf-8) Uint8Array\n  const hashBuffer = await window.crypto.subtle.digest(\"SHA-256\", msgUint8); // hash the message\n  const hashArray = Array.from(new Uint8Array(hashBuffer)); // convert buffer to byte array\n  const hashHex = hashArray\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\"); // convert bytes to hex string\n  return hashHex;\n}\n","/**\n * common.js\n */\n\n/* constants */\nconst TYPE_FROM = 8;\nconst TYPE_TO = -1;\n\n/**\n * get type\n * @param {*} o - object to check\n * @returns {string} - type of object\n */\nexport const getType = o =>\n  Object.prototype.toString.call(o).slice(TYPE_FROM, TYPE_TO);\n\n/**\n * is string\n * @param {*} o - object to check\n * @returns {boolean} - result\n */\nexport const isString = o => typeof o === 'string' || o instanceof String;\n","/**\n * semver.js\n * @see {@link http://semver.org/|Semantic Versioning}\n * @see {@link https://github.com/mojombo/semver/|mojombo/semver}\n */\n\n/* api */\nimport { getType, isString } from './common.js';\n\n/* constants */\nconst BASE = 10;\nconst INT = '0|[1-9]\\\\d*';\nconst ALPHA_NUM = '\\\\d*[A-Z-][A-Z\\\\d-]*';\nconst PRE_PART = `(?:${ALPHA_NUM}|${INT})`;\nconst PRE = `${PRE_PART}(?:\\\\.${PRE_PART})*`;\nconst BUILD_PART = `(?:${ALPHA_NUM}|\\\\d+)`;\nconst BUILD = `${BUILD_PART}(?:\\\\.${BUILD_PART})*`;\nconst SEMVER =\n  `((?:${INT})(?:\\\\.(?:${INT})){2})(?:-(${PRE}))?(?:\\\\+(${BUILD}))?`;\nconst REGEXP_INT = new RegExp(`^(?:${INT})$`);\nconst REGEXP_SEMVER = new RegExp(`^v?${SEMVER}$`, 'i');\nconst REGEXP_SEMVER_STRICT = new RegExp(`^${SEMVER}$`, 'i');\n\n/**\n * parsed SemVer object\n * @typedef {object} SemVerObject\n * @property {string} version - version string\n * @property {boolean} matches - matches SemVer format\n * @property {number|undefined} major - major version\n * @property {number|undefined} minor - minor version\n * @property {number|undefined} patch - patch version\n * @property {Array<string|number>|undefined} pre - pre-release version in array\n * @property {Array<string|number>|undefined} build - build ID in array\n */\n\n/**\n * is valid SemVer string\n * @param {string} version - version string\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {boolean} - result\n */\nexport const isValidSemVer = (version, strict = false) => {\n  if (!isString(version)) {\n    throw new TypeError(`Expected String but got ${getType(version)}.`);\n  }\n  const reg = strict ? REGEXP_SEMVER_STRICT : REGEXP_SEMVER;\n  return reg.test(version);\n};\n\n/**\n * parse version part\n * @param {string} part - version part\n * @param {boolean} [nonPosInt] - accept non positive integer\n * @returns {string|number} - parsed version part\n */\nexport const parseVersionPart = (part, nonPosInt = false) => {\n  if (!isString(part)) {\n    throw new TypeError(`Expected String but got ${getType(part)}.`);\n  }\n  if (!(nonPosInt || REGEXP_INT.test(part))) {\n    throw new Error(`${part} is not a stringified positive integer.`);\n  }\n  let parsedPart;\n  if (REGEXP_INT.test(part)) {\n    parsedPart = parseInt(part, BASE);\n    if (!Number.isSafeInteger(parsedPart)) {\n      throw new RangeError(`${parsedPart} exceeds ${Number.MAX_SAFE_INTEGER}.`);\n    }\n  } else {\n    parsedPart = part;\n  }\n  return parsedPart;\n};\n\n/**\n * compare SemVer\n * @param {string} version - version string\n * @param {string} base - base version string to compare from\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {number}\n *   - -1 or negative number, if version is less than base version\n *     0, if version is equal to base version\n *     1 or positive number, if version is greater than base version\n */\nexport const compareSemVer = (version, base, strict = false) => {\n  if (!isString(version)) {\n    throw new TypeError(`Expected String but got ${getType(version)}.`);\n  }\n  if (!isString(base)) {\n    throw new TypeError(`Expected String but got ${getType(base)}.`);\n  }\n  if (!isValidSemVer(version, !!strict)) {\n    throw new Error(`Invalid version string: ${version}`);\n  }\n  if (!isValidSemVer(base, !!strict)) {\n    throw new Error(`Invalid version string: ${base}`);\n  }\n  let result;\n  if (version === base) {\n    result = 0;\n  } else {\n    const reg = strict ? REGEXP_SEMVER_STRICT : REGEXP_SEMVER;\n    const [, vRel, vPre] = version.match(reg);\n    const [, bRel, bPre] = base.match(reg);\n    const [vMajor, vMinor, vPatch] =\n      vRel.split('.').map(part => parseVersionPart(part));\n    const [bMajor, bMinor, bPatch] =\n      bRel.split('.').map(part => parseVersionPart(part));\n    if (vMajor > bMajor) {\n      result = 1;\n    } else if (vMajor < bMajor) {\n      result = -1;\n    } else if (vMinor > bMinor) {\n      result = 1;\n    } else if (vMinor < bMinor) {\n      result = -1;\n    } else if (vPatch > bPatch) {\n      result = 1;\n    } else if (vPatch < bPatch) {\n      result = -1;\n    } else if (vPre === bPre) {\n      result = 0;\n    } else if (!vPre && bPre) {\n      result = 1;\n    } else if (vPre && !bPre) {\n      result = -1;\n    } else {\n      const vPreParts = vPre.split('.').map(part =>\n        parseVersionPart(part, true)\n      );\n      const bPreParts = bPre.split('.').map(part =>\n        parseVersionPart(part, true)\n      );\n      const l = Math.max(vPreParts.length, bPreParts.length);\n      let i = 0;\n      while (i < l) {\n        const vPart = vPreParts[i];\n        const bPart = bPreParts[i];\n        if ((vPart && !bPart) || (isString(vPart) && Number.isInteger(bPart))) {\n          result = 1;\n        } else if ((!vPart && bPart) ||\n                   (Number.isInteger(vPart) && isString(bPart))) {\n          result = -1;\n        } else if (vPart !== bPart && isString(vPart) && isString(bPart)) {\n          result = vPart.localeCompare(bPart);\n        } else if (Number.isInteger(vPart) && Number.isInteger(bPart)) {\n          if (vPart > bPart) {\n            result = 1;\n          } else if (vPart < bPart) {\n            result = -1;\n          }\n        }\n        if (Number.isInteger(result)) {\n          break;\n        }\n        i++;\n      }\n    }\n  }\n  return result;\n};\n\n/**\n * parse SemVer string\n * @param {string} version - version string\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {SemVerObject} - result\n */\nexport const parseSemVer = (version, strict = false) => {\n  if (!isString(version)) {\n    throw new TypeError(`Expected String but got ${getType(version)}.`);\n  }\n  const matches = isValidSemVer(version, !!strict);\n  let major, minor, patch, pre, build;\n  if (matches) {\n    const reg = strict ? REGEXP_SEMVER_STRICT : REGEXP_SEMVER;\n    const [, vRel, vPre, vBuild] = version.match(reg);\n    [major, minor, patch] = vRel.split('.').map(part => parseVersionPart(part));\n    if (vPre) {\n      pre = vPre.split('.').map(part => parseVersionPart(part, true));\n    }\n    if (vBuild) {\n      build = vBuild.split('.').map(part => parseVersionPart(part, true));\n    }\n  }\n  return {\n    version, matches, major, minor, patch, pre, build\n  };\n};\n\n/* async wrappers */\n/**\n * compare SemVer (async)\n * @param {string} version - version string\n * @param {string} base - base version string to compare from\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {Promise.<number>}\n *   - -1 or negative number, if version is less than base version\n *     0, if version is equal to base version\n *     1 or positive number, if version is greater than base version\n */\nconst compareSemVerAsync = async (version, base, strict = false) => {\n  const res = compareSemVer(version, base, strict);\n  return res;\n};\n\n/**\n * is valid SemVer string (async)\n * @param {string} version - version string\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {Promise.<boolean>} - result\n */\nconst isValidSemVerAsync = async (version, strict = false) => {\n  const res = isValidSemVer(version, strict);\n  return res;\n};\n\n/**\n * parse SemVer string (async)\n * @param {string} version - version string\n * @param {boolean} [strict] - reject 'v' prefixed\n * @returns {Promise.<SemVerObject>} - result\n */\nconst parseSemVerAsync = async (version, strict = false) => {\n  const res = parseSemVer(version, strict);\n  return res;\n};\n\n/* export async functions */\nexport const promises = {\n  compareSemVer: compareSemVerAsync,\n  isValidSemVer: isValidSemVerAsync,\n  parseSemVer: parseSemVerAsync\n};\n","import { parseSemVer } from \"semver-parser\";\n\nimport Analytics from \"./Analytics\";\nimport { ErrorReporterInjector, getTagsForReporting } from \"./Errors\";\nimport { I18nConfig } from \"./I18nConfig\";\nimport { bindAll } from \"./Scope\";\nimport BoardStorage from \"../storage/BoardStorage\";\nimport MemberStorage from \"../storage/MemberStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\n@ErrorReporterInjector\nclass VersionChecker {\n  boardStorage: BoardStorage;\n  memberStorage: MemberStorage;\n\n  constructor(boardStorage: BoardStorage, memberStorage: MemberStorage) {\n    this.boardStorage = boardStorage;\n    this.memberStorage = memberStorage;\n    bindAll(this);\n  }\n\n  async isThereANewMinorOrMajor(t: Trello.PowerUp.IFrame): Promise<boolean> {\n    const storedVersionRaw = await this.memberStorage.read<string>(\n      t,\n      MemberStorage.POWER_UP_VERSION,\n    );\n\n    if (!storedVersionRaw) {\n      return true;\n    }\n\n    const storedVersion = parseSemVer(storedVersionRaw);\n    const newVersion = parseSemVer(__BUILDTIME_VERSION__);\n\n    const isNewer =\n      newVersion.major > storedVersion.major ||\n      newVersion.minor > storedVersion.minor;\n\n    return !storedVersion || isNewer;\n  }\n\n  async showMenu(t: Trello.PowerUp.IFrame): Promise<void> {\n    const storedVersion = await this.memberStorage.read<string>(\n      t,\n      MemberStorage.POWER_UP_VERSION,\n    );\n    const title = storedVersion\n      ? t.localizeKey(\"boardButtonPopupTitle\", {\n          oldVersion: storedVersion,\n          newVersion: __BUILDTIME_VERSION__,\n        })\n      : t.localizeKey(\"boardButtonPopupTitleMissingVersion\", {\n          newVersion: __BUILDTIME_VERSION__,\n        });\n\n    return t.popup({\n      title: title,\n      url: `./release-notes.html?${await Analytics.getOverrides(this.boardStorage, t)}&${await getTagsForReporting(this.boardStorage, t)}`,\n      args: { version: __BUILDTIME_VERSION__, localization: I18nConfig },\n      callback: this.storeNewVersion,\n      height: 65,\n    });\n  }\n\n  async storeNewVersion(t: Trello.PowerUp.IFrame): Promise<void> {\n    await this.memberStorage.write(\n      t,\n      MemberStorage.POWER_UP_VERSION,\n      __BUILDTIME_VERSION__,\n    );\n  }\n}\n\nexport default VersionChecker;\n","import { ErrorReporterInjector } from \"./Errors\";\nimport { bindAll } from \"./Scope\";\nimport CardStorage from \"../storage/CardStorage\";\nimport { Trello } from \"../types/TrelloPowerUp\";\n\n@ErrorReporterInjector\nclass Voting {\n  cardStorage: CardStorage;\n\n  constructor() {\n    this.cardStorage = new CardStorage();\n    bindAll(this);\n  }\n\n  async hasCurrentMemberVoted(t: Trello.PowerUp.IFrame): Promise<boolean> {\n    const votes = await this.cardStorage.read<Votes>(t, CardStorage.VOTES);\n    if (!votes) {\n      return false;\n    }\n\n    const currentMember = t.getContext().member;\n    return !!votes[currentMember];\n  }\n\n  async getVotes(t: Trello.PowerUp.IFrame): Promise<Votes> {\n    return await this.cardStorage.read<Votes>(t, CardStorage.VOTES);\n  }\n\n  async countVotesByCard(\n    t: Trello.PowerUp.IFrame,\n    cardId: string,\n  ): Promise<number> {\n    const votes = await this.cardStorage.read<Votes>(\n      t,\n      CardStorage.VOTES,\n      cardId,\n    );\n\n    if (!votes) {\n      return 0;\n    }\n\n    return Object.keys(votes).filter((key) => votes[key]).length;\n  }\n\n  async getMaxVotes(t: Trello.PowerUp.IFrame): Promise<number> {\n    const currentList = await t.list(\"cards\");\n\n    // https://www.talcottridge.com/multi-voting-math-or-n3\n    return Math.ceil(currentList.cards.length / 3);\n  }\n\n  async canCurrentMemberVote(t: Trello.PowerUp.IFrame): Promise<boolean> {\n    if (await this.hasCurrentMemberVoted(t)) {\n      return true;\n    }\n\n    const currentList = await t.list(\"cards\");\n    const cardIds = currentList.cards.map((card) => card.id);\n    const currentMemberVotes = await this.countVotesByMember(t, cardIds);\n    const maxVotes = await this.getMaxVotes(t);\n\n    return currentMemberVotes < maxVotes;\n  }\n\n  async countVotesByMember(\n    t: Trello.PowerUp.IFrame,\n    cardIds: string[],\n  ): Promise<number> {\n    const listVotes: number[] = await Promise.all(\n      cardIds.map(async (cardId): Promise<number> => {\n        const votes = await this.cardStorage.read<Votes>(\n          t,\n          CardStorage.VOTES,\n          cardId,\n        );\n        if (!votes) {\n          return 0;\n        }\n\n        const currentMember = t.getContext().member;\n        return votes[currentMember] ? 1 : 0;\n      }),\n    );\n\n    return listVotes.reduce((total, vote): number => total + vote, 0);\n  }\n}\n\nexport default Voting;\n","import CapabilityHandlers from \"./CapabilityHandlers\";\nimport { LeanCoffeeBase, LeanCoffeeBaseParams } from \"./LeanCoffeeBase\";\nimport ElapsedCardBadge from \"./badges/ElapsedCardBadge\";\nimport ElapsedCardDetailBadge from \"./badges/ElapsedCardDetailBadge\";\nimport VotingCardBadge from \"./badges/VotingCardBadge\";\nimport VotingCardDetailBadge from \"./badges/VotingCardDetailBadge\";\nimport BoardStorage from \"./storage/BoardStorage\";\nimport CardStorage from \"./storage/CardStorage\";\nimport { Trello } from \"./types/TrelloPowerUp\";\nimport Analytics from \"./utils/Analytics\";\nimport Discussion from \"./utils/Discussion\";\nimport { getTagsForReporting, isRunningInProduction } from \"./utils/Errors\";\nimport { digestMessage } from \"./utils/Hashing\";\nimport { I18nConfig } from \"./utils/I18nConfig\";\nimport VersionChecker from \"./utils/VersionChecker\";\nimport Voting from \"./utils/Voting\";\n\nclass LeanCoffeePowerUp extends LeanCoffeeBase {\n  t: Trello.PowerUp;\n  baseUrl: string;\n  discussion: Discussion;\n  voting: Voting;\n  elapsedCardBadge: ElapsedCardBadge;\n  elapsedCardDetailBadge: ElapsedCardDetailBadge;\n  votingCardBadge: VotingCardBadge;\n  votingCardDetailBadge: VotingCardDetailBadge;\n  versionChecker: VersionChecker;\n  capabilityHandlers: CapabilityHandlers;\n\n  constructor({ w, config }: LeanCoffeeBaseParams) {\n    super({ w, config });\n    this.t = w.TrelloPowerUp;\n\n    const { hostname, port, defaultDuration } =\n      this.config[process.env.NODE_ENV as Environment];\n    this.baseUrl = `${hostname}${port ? `:${port}` : \"\"}`;\n\n    this.discussion = new Discussion(this.w, this.baseUrl, defaultDuration);\n    this.voting = new Voting();\n    this.versionChecker = new VersionChecker(\n      this.boardStorage,\n      this.memberStorage,\n    );\n\n    this.elapsedCardBadge = new ElapsedCardBadge(this.discussion);\n    this.elapsedCardDetailBadge = new ElapsedCardDetailBadge(this.discussion);\n    this.votingCardBadge = new VotingCardBadge(\n      this.w,\n      this.baseUrl,\n      this.voting,\n      this.boardStorage,\n      this.cardStorage,\n    );\n    this.votingCardDetailBadge = new VotingCardDetailBadge(\n      this.w,\n      this.baseUrl,\n      this.voting,\n      this.boardStorage,\n      this.cardStorage,\n    );\n    this.capabilityHandlers = new CapabilityHandlers(this);\n  }\n\n  async handleVoting(t: Trello.PowerUp.IFrame): Promise<void> {\n    if (!(await this.voting.canCurrentMemberVote(t))) {\n      return t.popup({\n        title: \"Leaner Coffee\",\n        url: `${this.baseUrl}/too_many_votes.html?${await Analytics.getOverrides(this.boardStorage, t)}&${await getTagsForReporting(this.boardStorage, t)}`,\n        args: {\n          maxVotes: await this.voting.getMaxVotes(t),\n          localization: I18nConfig,\n        },\n        height: 98,\n      });\n    }\n\n    const votes = (await this.voting.getVotes(t)) || {};\n    const currentMember = await t.member(\n      \"id\",\n      \"username\",\n      \"fullName\",\n      \"avatar\",\n    );\n\n    let outcome: string;\n\n    if (votes[currentMember.id]) {\n      delete votes[currentMember.id];\n      outcome = \"removed\";\n    } else {\n      votes[currentMember.id] = {\n        username: currentMember.username,\n        fullName: currentMember.fullName,\n        avatar: currentMember.avatar, // currently unused\n      };\n      outcome = \"added\";\n    }\n\n    await this.cardStorage.write(t, CardStorage.VOTES, votes);\n    await Analytics.event(this.w, \"voted\", { outcome: outcome });\n  }\n\n  async stopAndStart(t: Trello.PowerUp.IFrame): Promise<void> {\n    await Analytics.event(this.w, \"discussionStatusOverridden\");\n\n    await this.discussion.end(t);\n    await Analytics.event(this.w, \"discussionStatusChanged\", {\n      newStatus: \"stopped\",\n    });\n\n    await this.discussion.start(t);\n    await Analytics.event(this.w, \"discussionStatusChanged\", {\n      newStatus: \"started\",\n    });\n  }\n\n  async handleDiscussion(t: Trello.PowerUp.IFrame): Promise<void> {\n    if (await this.discussion.isOngoingOrPausedForAnotherCard(t)) {\n      const boardStatus = await this.boardStorage.read<DiscussionStatus>(\n        t,\n        BoardStorage.DISCUSSION_STATUS,\n      );\n      const cardId = await this.boardStorage.read<string>(\n        t,\n        BoardStorage.DISCUSSION_CARD_ID,\n      );\n\n      // https://github.com/tatablack/leaner-coffee-powerup/issues/12\n      if (await this.discussion.hasNotBeenArchived(t, cardId)) {\n        const allCards = await t.cards(\"id\", \"name\");\n        const cardBeingDiscussed = allCards.find((card) => card.id === cardId);\n\n        return t.popup({\n          callback: this.stopAndStart,\n          title: \"Leaner Coffee\",\n          url: `${this.baseUrl}/ongoing_or_paused.html?${await Analytics.getOverrides(this.boardStorage, t)}`,\n          args: {\n            currentCardBeingDiscussed: cardBeingDiscussed.name,\n            currentDiscussionStatus: boardStatus,\n            localization: I18nConfig,\n          },\n          height: 120,\n        });\n      }\n\n      console.warn(\n        `Card with id ${cardId} not found in current board, most likely archived. Cleaning up.`,\n      );\n\n      await Analytics.event(this.w, \"discussionMenuOpened\", {\n        status: \"ongoing other\",\n      });\n\n      await this.boardStorage.deleteMultiple(t, [\n        BoardStorage.DISCUSSION_STATUS,\n        BoardStorage.DISCUSSION_CARD_ID,\n        BoardStorage.DISCUSSION_STARTED_AT,\n        BoardStorage.DISCUSSION_PREVIOUS_ELAPSED,\n        BoardStorage.DISCUSSION_INTERVAL_ID,\n      ]);\n    }\n\n    let items: Trello.PowerUp.PopupOptionsItem[] = [];\n    let status: string;\n\n    switch (true) {\n      case await this.discussion.isOngoingFor(t):\n        items = [\n          {\n            text: t.localizeKey(\"pauseTimer\", { symbol: \"❙ ❙\" }), // MEDIUM VERTICAL BAR + NARROW NO-BREAK SPACE\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"paused\",\n              });\n              await this.discussion.pause(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"pausingTimer\", { symbol: \"❙ ❙\" }), // MEDIUM VERTICAL BAR + NARROW NO-BREAK SPACE\n              );\n            },\n          },\n          {\n            text: t.localizeKey(\"endDiscussion\", { symbol: \"■\" }), // BLACK SQUARE\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"stopped\",\n              });\n              await this.discussion.end(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"endingDiscussion\", { symbol: \"■\" }), // BLACK SQUARE\n              );\n            },\n          },\n        ];\n        status = \"ongoing\";\n        break;\n      case await this.discussion.isPausedFor(t):\n        items = [\n          {\n            text: t.localizeKey(\"resumeDiscussion\", { symbol: \"▶\" }), // BLACK RIGHT-POINTING TRIANGLE\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"resumed\",\n              });\n              await this.discussion.start(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"resumingDiscussion\", { symbol: \"▶\" }), // BLACK RIGHT-POINTING TRIANGLE\n              );\n            },\n          },\n          {\n            text: t.localizeKey(\"endDiscussion\", { symbol: \"■\" }), // BLACK SQUARE\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"stopped\",\n              });\n              await this.discussion.end(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"endingDiscussion\", { symbol: \"■\" }), // BLACK SQUARE\n              );\n            },\n          },\n        ];\n        status = \"paused\";\n        break;\n      default:\n        items = [\n          {\n            text: t.localizeKey(\"startTimer\", { symbol: \"▶\" }), // BLACK RIGHT-POINTING TRIANGLE\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"started\",\n              });\n              await this.discussion.start(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"startingTimer\", { symbol: \"▶\" }), // BLACK RIGHT-POINTING TRIANGLE\n              );\n            },\n          },\n        ];\n\n        if (await this.discussion.hasEverBeenDiscussed(t)) {\n          items.push({\n            text: t.localizeKey(\"resetDiscussion\", { symbol: \"↺\" }), // ANTICLOCKWISE OPEN CIRCLE ARROW\n            callback: async (t2: Trello.PowerUp.IFrame): Promise<void> => {\n              await Analytics.event(this.w, \"discussionStatusChanged\", {\n                newStatus: \"reset\",\n              });\n              await this.discussion.reset(t2);\n              await t2.closePopup();\n              await this.discussion.cardStorage.write(\n                t2,\n                CardStorage.DISCUSSION_BUTTON_LABEL,\n                t2.localizeKey(\"resettingDiscussion\", { symbol: \"↺\" }), // ANTICLOCKWISE OPEN CIRCLE ARROW\n              );\n            },\n          });\n          status = \"discussed before\";\n        } else {\n          status = \"never discussed\";\n        }\n    }\n\n    await Analytics.event(this.w, \"discussionMenuOpened\", { status });\n\n    return t.popup({\n      title: \"Leaner Coffee\",\n      items,\n    });\n  }\n\n  async getButtonLabel(t: Trello.PowerUp.IFrame): Promise<string> {\n    let label = await this.discussion.cardStorage.read<string>(\n      t,\n      CardStorage.DISCUSSION_BUTTON_LABEL,\n    );\n\n    if (label) {\n      setTimeout(() => {\n        this.discussion.cardStorage.write(\n          t,\n          CardStorage.DISCUSSION_BUTTON_LABEL,\n          null,\n        );\n      }, 2000);\n    }\n\n    label = label || t.localizeKey(\"discussion\");\n\n    return label;\n  }\n\n  async handlePowerupEnabled(t: Trello.PowerUp.AnonymousHostHandlers) {\n    const organisation = await t.organization(\"id\");\n    const board = await t.board(\"id\");\n    const organisationIdHash = await digestMessage(organisation.id);\n    const boardIdHash = await digestMessage(board.id);\n\n    await this.boardStorage.writeMultiple(t, {\n      [BoardStorage.POWER_UP_INSTALLATION_DATE]: new Date().toISOString(),\n      [BoardStorage.ORGANISATION_HASH]: organisationIdHash,\n      [BoardStorage.BOARD_HASH]: boardIdHash,\n    });\n  }\n\n  async start(): Promise<void> {\n    const trelloPlugin = this.t.initialize(this.capabilityHandlers.getAll(), {\n      localization: I18nConfig,\n      helpfulStacks: !isRunningInProduction(),\n    });\n\n    this.discussion.init(trelloPlugin);\n\n    // There can be a race condition between the power-up starting\n    // and the on-enable event being triggered.\n    await navigator.locks.request(\n      \"powerup_init\",\n      { ifAvailable: true },\n      async (lock) => {\n        // if the lock is null, it means the on-enable handler is taking care of initialisation\n        if (lock === null) {\n          return;\n        }\n\n        if (\n          !(await this.boardStorage.read<string>(\n            trelloPlugin,\n            BoardStorage.POWER_UP_INSTALLATION_DATE,\n          ))\n        ) {\n          await this.handlePowerupEnabled(trelloPlugin);\n        }\n      },\n    );\n\n    const organisationIdHash = await this.boardStorage.read<string>(\n      trelloPlugin,\n      BoardStorage.ORGANISATION_HASH,\n    );\n    const boardIdHash = await this.boardStorage.read<string>(\n      trelloPlugin,\n      BoardStorage.BOARD_HASH,\n    );\n\n    if (window.Sentry) {\n      window.Sentry.onLoad(async () => {\n        window.Sentry.setTags({\n          organisationIdHash: organisationIdHash,\n          boardIdHash: boardIdHash,\n        });\n      });\n    }\n\n    this.w.LeanerCoffeeAnalyticsReferrer = \"https://\" + organisationIdHash;\n    this.w.LeanerCoffeeAnalyticsHostname = boardIdHash;\n    this.w.LeanerCoffeeAnalyticsBeforeSend = Analytics.beforeSend;\n\n    window.setTimeout(async () => {\n      await Analytics.pageview(this.w);\n    }, 0);\n  }\n}\n\nexport default LeanCoffeePowerUp;\n","import LeanCoffeePowerUp from \"./LeanCoffeePowerUp\";\n\ndeclare global {\n  interface Window {\n    webkitAudioContext?: typeof AudioContext;\n  }\n}\n\nconst config: Config = process.env.CONFIG as unknown as Config;\n\nconst instance = new LeanCoffeePowerUp({\n  w: window,\n  config,\n});\n\ninstance.start();\n"],"names":["addZero","value","digits","str","toString","size","length","Array","join","concat","module","exports","ms","options","leading","showMs","unsignedMs","sign","duration","getSign","t","TypeError","days","Math","trunc","hours","minutes","seconds","parseMs","output","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","getTagsForReporting","async","boardStorage","read","ORGANISATION_HASH","BOARD_HASH","ErrorReporter","target","methodName","descriptor","originalMethod","isAsync","constructor","name","warningMessage","args","apply","this","error","console","warn","window","Sentry","captureException","ErrorReporterInjector","getOwnPropertyNames","filter","forEach","getOwnPropertyDescriptor","decoratedDescriptor","bindAll","classInstance","p","bind","Storage","scope","visibility","assign","canWrite","memberCanWriteToModel","getMemberType","board","currentMember","member","myMembership","memberships","find","m","idMember","id","memberType","cardId","write","addBreadcrumb","category","message","level","set","Error","contexts","WriteOperation","hasCardId","writeMultiple","entries","keys","remove","DeleteOperation","deleteMultiple","BoardStorage","super","DISCUSSION_STATUS","DISCUSSION_CARD_ID","DISCUSSION_STARTED_AT","DISCUSSION_PREVIOUS_ELAPSED","DISCUSSION_INTERVAL_ID","POWER_UP_INSTALLATION_DATE","CardStorage","DISCUSSION_ELAPSED","DISCUSSION_THUMBS","VOTES","DISCUSSION_BUTTON_LABEL","sanitiseUrl","urlString","url","URL","protocol","hostname","port","pathname","beforeSend","event","payload","referrer","LeanerCoffeeAnalyticsReferrer","LeanerCoffeeAnalyticsHostname","pageview","eventData","umami","track","props","eventName","getOverrides","organisationIdHash","boardIdHash","encodeURIComponent","INTERVALS","supportedLocales","I18nConfig","defaultLocale","resourceUrl","CapabilityHandlers","powerUp","boardButtonsHandler","versionChecker","isThereANewMinorOrMajor","icon","dark","baseUrl","light","text","localizeKey","callback","showMenu","cardBackSection","discussion","cardStorage","title","content","type","signUrl","cardBadges","elapsedCardBadge","render","votingCardBadge","badge","cardButtons","getButtonLabel","handleDiscussion","symbol","voting","hasCurrentMemberVoted","handleVoting","cardDetailBadges","elapsedCardDetailBadge","votingCardDetailBadge","listActions","Promise","resolve","t2","list","cards","listSorters","opts","sortedCards","all","map","card","leanCoffeeVotes","countVotesByCard","sort","cardA","cardB","sortedIds","onEnable","navigator","locks","request","ifAvailable","lock","isInitialised","handlePowerupEnabled","onDisable","installationDate","installedFor","Date","now","parse","showSettings","popup","height","localization","getAll","MemberStorage","POWER_UP_VERSION","LeanCoffeeBase","w","config","memberStorage","ElapsedCardBadge","getText","elapsed","getColor","isOngoingFor","isPausedFor","getElapsed","Number","isFinite","color","discussionStatus","captureMessage","CardDetailBadge","discussionElapsed","discussionButtonLabel","VotingCardBadge","getVoters","votes","getVotes","values","reduce","knownVoters","vote","username","push","fullName","avatar","voters","hasVoted","clearVoters","totalVoters","delete","total","showVoters","items","commonData","Notifications","load","remoteAudioFile","fetch","audioData","arrayBuffer","audioBuffer","audioContext","decodeAudioData","sourceNode","createBufferSource","buffer","connect","destination","play","AudioContext","webkitAudioContext","audio","start","open","cardName","Notification","body","show","permission","requestPermission","Discussion","maxDiscussionDuration","init","getElapsedNotification","isOngoingOrPausedForAnotherCard","boardStatus","includes","getContext","hasEverBeenDiscussed","hasNotBeenArchived","updateElapsed","startedAt","saveElapsed","pause","newStatus","previousElapsed","setInterval","notify","intervalId","clearInterval","elapsedNotification","notifications","end","reset","digestMessage","msgUint8","TextEncoder","encode","hashBuffer","crypto","subtle","digest","from","Uint8Array","b","padStart","getType","slice","isString","String","INT","ALPHA_NUM","PRE_PART","BUILD_PART","SEMVER","REGEXP_INT","RegExp","REGEXP_SEMVER","REGEXP_SEMVER_STRICT","isValidSemVer","version","strict","test","parseVersionPart","part","nonPosInt","parsedPart","parseInt","isSafeInteger","RangeError","MAX_SAFE_INTEGER","parseSemVer","matches","major","minor","patch","pre","build","reg","vRel","vPre","vBuild","match","split","VersionChecker","storedVersionRaw","storedVersion","newVersion","isNewer","oldVersion","storeNewVersion","Voting","getMaxVotes","currentList","ceil","canCurrentMemberVote","cardIds","countVotesByMember","TrelloPowerUp","defaultDuration","capabilityHandlers","maxVotes","outcome","stopAndStart","cardBeingDiscussed","currentCardBeingDiscussed","currentDiscussionStatus","status","closePopup","label","setTimeout","organisation","organization","toISOString","trelloPlugin","initialize","helpfulStacks","onLoad","setTags","LeanerCoffeeAnalyticsBeforeSend"],"sourceRoot":""}